<html><head><title>afsd</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Sat Mar 29 18:17:47 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>afsd - Initializes the Cache Manager and starts related daemons</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>afsd</b> [<b>-afsdb</b>] [<b>-backuptree</b>] [<b>-biods</b>&#160;&#60;<i>number&#160;of&#160;bkg&#160;I/O&#160;daemons&#160;(aix&#160;vm)</i>&#62;] [<b>-blocks</b>&#160;&#60;<i>1024&#160;byte&#160;blocks&#160;in&#160;cache</i>&#62;] [<b>-cachedir</b>&#160;&#60;<i>cache&#160;directory</i>&#62;] [<b>-chunksize</b>&#160;&#60;<i>log(2)&#160;of&#160;chunk&#160;size</i>&#62;] [<b>-confdir</b>&#160;&#60;<i>configuration&#160;directory</i>&#62;] [<b>-daemons</b>&#160;&#60;<i>number&#160;of&#160;daemons&#160;to&#160;use</i>&#62;] [<b>-dcache</b>&#160;&#60;<i>number&#160;of&#160;dcache&#160;entries</i>&#62;] [<b>-debug</b>] [<b>-dynroot</b>] [<b>-enable_peer_stats</b>] [<b>-enable_process_stats</b>] [<b>-fakestat</b>] [<b>-fakestat-all</b>] [<b>-files</b>&#160;&#60;<i>files&#160;in&#160;cache</i>&#62;] [<b>-files_per_subdir</b>&#160;&#60;<i>log(2)&#160;of&#160;files&#160;per&#160;dir</i>&#62;&#160;] [<b>-help</b>] [<b>-logfile</b>&#160;&#60;<i>Place&#160;to&#160;keep&#160;the&#160;CM&#160;log</i>&#62;] [<b>-mem_alloc_sleep</b>] [<b>-memcache</b>] [<b>-mountdir</b>&#160;&#60;<i>mount&#160;location</i>&#62;] [<b>-nomount</b>] [<b>-nosettime</b>] [<b>-prealloc</b>&#160;&#60;<i>number&#160;of&#160;&#39;small&#39;&#160;preallocated&#160;blocks</i>&#62;] [<b>-rmtsys</b>] [<b>-rootvol</b>&#160;&#60;<i>name&#160;of&#160;AFS&#160;root&#160;volume</i>&#62;] [<b>-rxbind</b>] [<b>-rxpck</b>&#160;value&#160;for&#160;rx_extraPackets&#160;] [<b>-settime</b>] [<b>-shutdown</b>] [<b>-splitcache</b>&#160;&#60;<i>RW/RO&#160;ratio</i>&#62;] [<b>-stat</b>&#160;&#60;<i>number&#160;of&#160;stat&#160;entries</i>&#62;] [<b>-verbose</b>] [<b>-volumes</b>&#160;&#60;<i>number&#160;of&#160;volume&#160;entries</i>&#62;] [<b>-waitclose</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>afsd</b> command initializes the Cache Manager on an AFS client machine by transferring AFS-related configuration information into kernel memory and starting several daemons.
More specifically,
the <b>afsd</b> command performs the following actions:</p>

<ul><li><p>Sets a field in kernel memory that defines the machine&#39;s cell membership.
Some Cache Manager-internal operations and system calls consult this field to learn which cell to execute in.
(The AFS command interpreters refer to the <em>/usr/vice/etc/ThisCell</em> file instead.) This information is transferred into the kernel from the <em>/usr/vice/etc/ThisCell</em> file and cannot be changed until the <b>afsd</b> program runs again.</p></li><li><p>Places in kernel memory the names and Internet addresses of the database server machines in the local cell and (optionally) foreign cells.
The appearance of a cell&#39;s database server machines in this list enables the Cache Manager to contact them and to access files in the cell.
Omission of a cell from this list,
or incorrect information about its database server machines,
prevents the Cache Manager from accessing files in it.
<p>By default,
the list of database server machines is transferred into the kernel from the <em>/usr/vice/etc/CellServDB</em> file.
Alternatively,
when the <b>-afsdb</b> option is used,
the list of database server machines is taken from the AFSDB DNS records for each cell.
After initialization,
use the <b>fs newcell</b> command to change the kernel-resident list without having to reboot.</p>
</p></li><li><p>Mounts the root of the AFS filespace on a directory on the machine&#39;s local disk,
according to either the first field in the <em>/usr/vice/etc/cacheinfo</em> file (the default) or the <b>afsd</b> command&#39;s <b>-mountdir</b> argument.
The conventional value is <em>/afs</em>.</p></li><li><p>Determines which volume to mount at the root of the AFS file tree.
The default is the volume <code>root.afs</code>; use the <b>-rootvol</b> argument to override it.
Although the base (read/write) form of the volume name is the appropriate value,
the Cache Manager has a bias for accessing the read-only version of the volume (by convention,
<code>root.afs.readonly</code>) if it is available.</p></li><li><p>Configures the cache on disk (the default) or in machine memory if the <b>-memcache</b> argument is provided.
In the latter case,
the <b>afsd</b> program allocates space in machine memory for caching,
and the Cache Manager uses no disk space for caching even if the machine has a disk.</p></li><li><p>Defines the name of the local disk directory devoted to caching,
when the <b>-memcache</b> argument is not used.
If necessary,
the <b>afsd</b> program creates the directory (its parent directory must already exist).
It does not remove the directory that formerly served this function,
if one exists.
<p>The second field in the <em>/usr/vice/etc/cacheinfo</em> file is the source for this name.
The standard value is <em>/usr/vice/cache</em>.
Use the <b>-cachedir</b> argument to override the value in the <b>cacheinfo</b> file.</p>
</p></li><li><p>Sets the size of the cache.
The default source for the value is the third field in the <em>/usr/vice/etc/cacheinfo</em> file,
which specifies a number of kilobytes.
<p>For a memory cache,
the following arguments to the afsd command override the value in the <b>cacheinfo</b> file:</p>

<ul><li><p>The <b>-blocks</b> argument,
to specify a different number of kilobyte blocks.</p></li><li><p>The <b>-dcache</b> and <b>-chunksize</b> arguments together,
to set both the number of dcache entries and the chunk size (see below for definition of these parameters).
In this case,
the <b>afsd</b> program derives cache size by multiplying the two values.
Using this combination is not recommended,
as it requires the issuer to perform the calculation beforehand to determine the resulting cache size.</p></li><li><p>The <b>-dcache</b> argument by itself.
In this case,
the <b>afsd</b> program derives cache size by multiplying the value specified by the <b>-dcache</b> argument by the default memory cache chunk size of eight kilobytes.
Using this argument is not recommended,
as it requires the issuer to perform the calculation beforehand to determine the resulting cache size.</p></li></ul>

<p>For satisfactory memory cache performance,
the specified value must leave enough memory free to accommodate all other processes and commands that can run on the machine.
If the value exceeds the amount of memory available,
the <b>afsd</b> program exits without initializing the Cache Manager and produces the following message on the standard output stream:</p>

<pre>   afsd: memCache allocation failure at &#60;number&#62; KB</pre>

<p>where &#60;number&#62; is how many kilobytes were allocated just before the failure.</p>

<p>For a disk cache, use the <b>-blocks</b> argument to the <b>afsd</b> command to override the value in the <b>cacheinfo</b> file. The value specified in either way sets an absolute upper limit on cache size; values provided for other arguments (such as <b>-dcache</b> and <b>-chunksize</b>) never result in a larger cache. The <b>afsd</b> program rejects any setting larger than 95% of the partition size, and exits after generating an error message on the standard output stream, because the cache implementation itself requires a small amount of disk space and overfilling the partition can cause the client machine to panic.</p>

<p>To change the size of a disk cache after initialization without rebooting, use the <b>fs setcachesize</b> command; the setting persists until the <b>afsd</b> command runs again or the <b>fs setcachesize</b> command is reissued. The <b>fs setcachesize</b> command does not work for memory caches.</p>
</p></li><li><p>Sets the size of each cache <i>chunk</i>, and by implication the amount of data that the Cache Manager requests at a time from the File Server (how much data per fetch RPC, since AFS uses partial file transfer).
<p>For a disk cache, a chunk is a <em>V<i>n</i></em> file and this parameter sets the maximum size to which each one can expand; the default is 64 KB. For a memory cache, each chunk is a collection of contiguous memory blocks; the default is size is 8 KB.</p>

<p>To override the default chunk size for either type of cache, use the <b>-chunksize</b> argument to provide an integer to be used as an exponent of two; see <a href="./OPTIONS.html" class="podlinkpod"
>OPTIONS</a> for details. For a memory cache, if total cache size divided by chunk size leaves a remainder, the <b>afsd</b> program rounds down the number of dcache entries, resulting in a slightly smaller cache.</p>
</p></li><li><p>Sets the number of chunks in the cache. For a memory cache, the number of chunks is equal to the cache size divided by the chunk size. For a disk cache, the number of chunks (<em>V<i>n</i></em> files) is set to the largest of the following unless the <b>-files</b> argument is used to set the value explicitly:
<ul><li><p>100</p></li><li><p>1.5 times the result of dividing cache size by chunk size (<i>cachesize</i>/<i>chunksize</i> * 1.5)</p></li><li><p>The result of dividing cachesize by 10 KB (<i>cachesize</i>/10240)</p></li></ul>
</p></li><li><p>Sets the number of <i>dcache entries</i> allocated in machine memory for storing information about the chunks in the cache.
<p>For a disk cache, the <em>/usr/vice/cache/CacheItems</em> file contains one entry for each <em>V<i>n</i></em> file. By default, one half the number of these entries (but not more that 2,000) are duplicated as dcache entries in machine memory for quicker access.</p>

<p>For a memory cache, there is no <em>CacheItems</em> file so all information about cache chunks must be in memory as dcache entries. Thus, there is no default number of dcache entries for a memory cache; instead, the <b>afsd</b> program derives it by dividing the cache size by the chunk size.</p>

<p>To set the number of dcache entries, use the <b>-dcache</b> argument; the specified value can exceed the default limit of 2,000. Using this argument is not recommended for either type of cache. Increasing the number of dcache entries for a disk cache sometimes improves performance (because more entries are retrieved from memory rather than from disk), but only marginally. Using this argument for a memory cache requires the issuer to calculate the cache size by multiplying this value by the chunk size.</p>
</p></li><li><p>Sets the number of <i>stat</i> entries available in machine memory for caching status information about cached AFS files. The default is 300; use the <b>-stat</b> argument to override the default.</p></li><li><p>If the <b>-settime</b> option is specified, then it randomly selects a file server machine in the local cell as the source for the correct time. Every five minutes thereafter, the local clock is adjusted (if necessary) to match the file server machine&#39;s clock. This is not enabled by default. It is recommended, instead, that the Network Time Protocol Daemon be used to synchronize the time.</p></li></ul>

<p>In addition to setting cache configuration parameters, the <b>afsd</b> program starts the following daemons. (On most system types, these daemons appear as nameless entries in the output of the UNIX <b>ps</b> command.)</p>

<ul><li><p>One <i>callback</i> daemon, which handles callbacks. It also responds to the File Server&#39;s periodic probes, which check that the client machine is still alive.</p></li><li><p>One <i>maintenance</i> daemon, which performs the following tasks:
<ul><li><p>Garbage collects obsolete data (for example, expired tokens) from kernel memory.</p></li><li><p>Synchronizes files.</p></li><li><p>Refreshes information from read-only volumes once per hour.</p></li><li><p>Does delayed writes for NFS clients if the machine is running the NFS/AFS Translator.</p></li></ul>
</p></li><li><p>One <i>cache-truncation</i> daemon, which flushes the cache when free space is required, by writing cached data and status information to the File Server.</p></li><li><p>One <i>server connection</i> daemon, which sends a probe to the File Server every few minutes to check that it is still accessible. If the <b>-settime</b> option is set, it also synchronizes the machine&#39;s clock with the clock on a randomly-chosen file server machine. There is always one server connection daemon.</p></li><li><p>One or more <i>background</i> daemons that improve performance by pre-fetching files and performing background (delayed) writes of saved data into AFS.
<p>The default number of background daemons is two, enough to service at least five simultaneous users of the machine. To increase the number, use the <b>-daemons</b> argument. A value greater than six is not generally necessary.</p>
</p></li><li><p>On some system types, one <i>Rx listener</i> daemon, which listens for incoming RPCs.</p></li><li><p>On some system types, one <i>Rx event</i> daemon, which reviews the Rx system&#39;s queue of tasks and performs them as appropriate. Most items in the queue are retransmissions of failed packets.</p></li><li><p>On machines that run AIX with virtual memory (VM) integration, one or more <i>VM</i> daemons (sometimes called <i>I/O</i> daemons, which transfer data between disk and machine memory. The number of them depends on the setting of the <b>-biods</b> and <b>-daemons</b> arguments:
<ul><li><p>If the <b>-biods</b> argument is used, it sets the number of VM daemons.</p></li><li><p>If only the <b>-daemons</b> argument is used, the number of VM daemons is twice the number of background daemons.</p></li><li><p>If neither argument is used, there are five VM daemons.</p></li></ul>
</p></li></ul>

<p>This command does not use the syntax conventions of the AFS command suites. Provide the command name and all option names in full.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>Before using the <b>-shutdown</b> parameter, use the standard UNIX <b>umount</b> command to unmount the AFS root directory (by convention, <em>/afs</em>). On Linux, unloading the AFS kernel module and then loading it again before restarting AFS after <b>-shutdown</b> is recommended.</p>

<p>AFS has for years had difficulties with being stopped and restarted without an intervening reboot. While most of these issues have been ironed out, stopping and restarting AFS is not recommended unless necessary and rebooting before restarting AFS is still the safest course of action. This does not apply to Linux; it should be safe to restart the AFS client on Linux without rebooting.</p>

<p>In contrast to many client-server applications, not all communication is initiated by the client. When the AFS client opens a file, it registers a callback with the AFS server. If the file changes, the server notifies the client that the file has changed and that all cached copies should be discarded. In order to enable full functionality on the AFS client, including all command-line utilities, the following UDP ports must be open on an firewalls between the client and the server:</p>

<pre>   fileserver      7000/udp 
   cachemanager    7001/udp (OpenAFS client. Arla uses 4711/udp)
   ptserver        7002/udp
   vlserver        7003/udp
   kaserver        7004/udp (not needed with Kerberos v5)
   volserver       7005/udp
   reserved        7006/udp (for future use)
   bosserver       7007/udp</pre>

<p>Additionally, for <b>klog</b> to work through the firewall you need to allow inbound and outbound UDP on ports &#62;1024 (probably 1024&#60;port&#60;2048 would suffice depending on the number of simultaneous <b>klog</b>s).</p>

<p>Be sure to set the UDP timeouts on the firewall to be at least twenty minutes for the best callback performance.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-afsdb"
><b>-afsdb</b></a></dt>

<dd>
<p>Enable afsdb support. This will use DNS to lookup the AFSDB record and use that for the database servers for each cell instead of the values in the <em>CellServDB</em> file. This has the advantage of only needing to update one DNS record to reconfigure the AFS clients for a new database server as opposed to touching all of the clients, and also allows one to access a cell without preconfiguring its database servers in <em>CellServDB</em>. The format of AFSDB records is defined in RFC 1183.</p>

<dt><a name="-backuptree"
><b>-backuptree</b></a></dt>

<dd>
<p>Prefer backup volumes for mountpoints in backup volumes. This option means that the AFS client will prefer to resolve mount points to backup volumes when a parent of the current volume is a backup volume. This is similar to the standard behaviour of preferring read-only volumes over read-write volumes when the parent volume is a read-only volume.</p>

<dt><a name="-biods_&#60;number_of_I/O_daemons&#62;"
><b>-biods</b> &#60;<i>number of I/O daemons</i>&#62;</a></dt>

<dd>
<p>Sets the number of VM daemons dedicated to performing I/O operations on a machine running a version of AIX with virtual memory (VM) integration. If both this argument and the <b>-daemons</b> argument are omitted, the default is five. If this argument is omitted but the <b>-daemons</b> argument is provided, the number of VM daemons is set to twice the value of the <b>-daemons</b> argument.</p>

<dt><a name="-blocks_&#60;blocks_in_cache&#62;"
><b>-blocks</b> &#60;<i>blocks in cache</i>&#62;</a></dt>

<dd>
<p>Specifies the number of kilobyte blocks to be made available for caching in the machine&#39;s cache directory (for a disk cache) or memory (for a memory cache), overriding the default defined in the third field of the <em>/usr/vice/etc/cacheinfo</em> file. For a disk cache, the value cannot exceed 95% of the space available in the cache partition. If using a memory cache, do not combine this argument with the <b>-dcache</b> argument, since doing so can possibly result in a chunk size that is not an exponent of 2.</p>

<dt><a name="-cachedir_&#60;cache_directory&#62;"
><b>-cachedir</b> &#60;<i>cache directory</i>&#62;</a></dt>

<dd>
<p>Names the local disk directory to be used as the cache. This value overrides the default defined in the second field of the <em>/usr/vice/etc/cacheinfo</em> file.</p>

<dt><a name="-chunksize_&#60;chunk_size&#62;"
><b>-chunksize</b> &#60;<i>chunk size</i>&#62;</a></dt>

<dd>
<p>Sets the size of each cache chunk. The integer provided, which must be from the range <code>0</code> to <code>30</code>, is used as an exponent on the number 2. It overrides the default of 16 for a disk cache (2^16 is 64 KB) and 13 for a memory cache (2^13 is 8 KB). A value of <code>0</code> or less, or greater than <code>30</code>, sets chunk size to the appropriate default. Values less than <code>10</code> (which sets chunk size to a 1 KB) are not recommended. Combining this argument with the <b>-dcache</b> argument is not recommended because it requires that the issuer calculate the cache size that results.</p>

<p><b>-chunksize</b> is an important option when tuning for performance. Setting this option to larger values can increase performance when dealing with large files.</p>

<dt><a name="-confdir_&#60;configuration_directory&#62;"
><b>-confdir</b> &#60;<i>configuration directory</i>&#62;</a></dt>

<dd>
<p>Names a directory other than the <em>/usr/vice/etc</em> directory from which to fetch the <em>cacheinfo</em>, <em>ThisCell</em>, and <em>CellServDB</em> configuration files.</p>

<dt><a name="-daemons_&#60;number_of_daemons_to_use&#62;"
><b>-daemons</b> &#60;<i>number of daemons to use</i>&#62;</a></dt>

<dd>
<p>Specifies the number of background daemons to run on the machine. These daemons improve efficiency by doing prefetching and background writing of saved data. This value overrides the default of <code>2</code>, which is adequate for a machine serving up to five users. Values greater than <code>6</code> are not generally more effective than <code>6</code>.</p>

<p>Note: On AIX machines with integrated virtual memory (VM), the number of VM daemons is set to twice the value of this argument, if it is provided and the <b>-biods</b> argument is not. If both arguments are omitted, there are five VM daemons.</p>

<dt><a name="-dcache_&#60;number_of_dcache_entries&#62;"
><b>-dcache</b> &#60;<i>number of dcache entries</i>&#62;</a></dt>

<dd>
<p>Sets the number of dcache entries in memory, which are used to store information about cache chunks. For a disk cache, this overrides the default, which is 50% of the number of <em>V<i>n</i></em> files (cache chunks). For a memory cache, this argument effectively sets the number of cache chunks, but its use is not recommended, because it requires the issuer to calculate the resulting total cache size (derived by multiplying this value by the chunk size). Do not combine this argument with the <b>-blocks</b> argument, since doing so can possibly result in a chunk size that is not an exponent of 2.</p>

<dt><a name="-debug"
><b>-debug</b></a></dt>

<dd>
<p>Generates a highly detailed trace of the <b>afsd</b> program&#39;s actions on the standard output stream. The information is useful mostly for debugging purposes.</p>

<dt><a name="-dynroot"
><b>-dynroot</b></a></dt>

<dd>
<p>The standard behaviour of the AFS client without the <b>-dynroot</b> option is to mount the root.afs volume from the default cell on the <em>/afs</em> path. The <em>/afs</em> folder and root.afs volume traditionally shows the folders for <em>ThisCell</em> and other cells as configured by the AFS cell administrator.</p>

<p>The <b>-dynroot</b> option changes this. Using this option, the AFS client does not mount the root.afs volume on <em>/afs</em>. Instead it uses the contents of the <em>CellServDB</em> file to populate the listing of cells in <em>/afs</em>. This is known as a DYNamic ROOT. A cell is not contacted until the path <em>/afs/<i>cellname</i></em> if accessed. This functions similarly to an automounter. The main advantage of using <b>-dynroot</b> is that the AFS client will start properly even without network access, whereas the client not using <b>-dynroot</b> will freeze upon startup if cannot contact the default cell specified in <em>ThisCell</em> and mount the root.afs volume. Dynamic root mode is also sometimes called travelling mode because it works well for laptops which don&#39;t always have network connectivity.</p>

<p>Two advantages of not using dynroot are that listing <em>/afs</em> will usually be faster because the contents of <em>/afs</em> are limited to what the AFS administrator decides and that symbolic links are traditionally created by the AFS administrator to provide a short name for the cell (i.e. cellname.domain.com is aliased to cellname). However, with dynroot, the local system administrator can limit the default contents of <em>/afs</em> by installing a stripped-down <em>CellServDB</em> file, and if dynroot is in effect, the <em>CellAlias</em> file can be used to provide shortname for common AFS cells which provides equivalent functionality to the most commonly used symbolic links.</p>

<dt><a name="-enable_peer_stats"
><b>-enable_peer_stats</b></a></dt>

<dd>
<p>Activates the collection of Rx statistics and allocates memory for their storage. For each connection with a specific UDP port on another machine, a separate record is kept for each type of RPC (FetchFile, GetStatus, and so on) sent or received. To display or otherwise access the records, use the Rx Monitoring API.</p>

<dt><a name="-enable_process_stats"
><b>-enable_process_stats</b></a></dt>

<dd>
<p>Activates the collection of Rx statistics and allocates memory for their storage. A separate record is kept for each type of RPC (FetchFile, GetStatus, and so on) sent or received, aggregated over all connections to other machines. To display or otherwise access the records, use the Rx Monitoring API.</p>

<dt><a name="-fakestat"
><b>-fakestat</b></a></dt>

<dd>
<p>Return fake values for stat calls on cross-cell mounts. This option makes an <code>ls -l</code> of <em>/afs</em> much faster since each cell isn&#39;t contacted, and this and the <b>-fakestat-all</b> options are useful on Mac OS X so that the Finder program doesn&#39;t try to contact every AFS cell the system knows about.</p>

<dt><a name="-fakestat-all"
><b>-fakestat-all</b></a></dt>

<dd>
<p>Return fake values for stat calls on all mounts, not just cross-cell mounts. This and the <b>-fakestat</b> options are useful on Mac OS X so that the Finder program doesn&#39;t hang when browsing AFS directories.</p>

<dt><a name="-files_&#60;files_in_cache&#62;"
><b>-files</b> &#60;<i>files in cache</i>&#62;</a></dt>

<dd>
<p>Specifies the number of <em>V<i>n</i></em> files to create in the cache directory for a disk cache, overriding the default that is calculated as described in <a href="./DESCRIPTION.html" class="podlinkpod"
>DESCRIPTION</a>. Each <em>V<i>n</i></em> file accommodates a chunk of data, and can grow to a maximum size of 64 KB by default. Do not combine this argument with the <b>-memcache</b> argument.</p>

<dt><a name="-files_per_subdir_&#60;files_per_cache_subdirectory&#62;"
><b>-files_per_subdir</b> &#60;<i>files per cache subdirectory</i>&#62;</a></dt>

<dd>
<p>Limits the number of cache files in each subdirectory of the cache directory. The value of the option should be the base-two log of the number of cache files per cache subdirectory (so 10 for 1024 files, 14 for 16384 files, and so forth).</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command. All other valid options are ignored.</p>

<dt><a name="-logfile_&#60;log_file_location&#62;"
><b>-logfile</b> &#60;<i>log file location</i>&#62;</a></dt>

<dd>
<p>This option is obsolete and no longer has any effect.</p>

<dt><a name="-mem_alloc_sleep"
><b>-mem_alloc_sleep</b></a></dt>

<dd>
<p>Allows sleeps when allocating a memory cache.</p>

<dt><a name="-memcache"
><b>-memcache</b></a></dt>

<dd>
<p>Initializes a memory cache rather than a disk cache. Do not combine this flag with the <b>-files</b> argument.</p>

<dt><a name="-mountdir_&#60;mount_location&#62;"
><b>-mountdir</b> &#60;<i>mount location</i>&#62;</a></dt>

<dd>
<p>Names the local disk directory on which to mount the root of the AFS filespace. This value overrides the default defined in the first field of the <em>/usr/vice/etc/cacheinfo</em> file. If a value other than the <em>/afs</em> directory is used, the machine cannot access the filespace of cells that do use that value.</p>

<dt><a name="-nomount"
><b>-nomount</b></a></dt>

<dd>
<p>Do not mount AFS on startup. The afs global mount must be mounted via some other means. This is useful on Mac OS X where /afs is sometimes mounted in /Network/afs like other network file systems.</p>

<dt><a name="-nosettime"
><b>-nosettime</b></a></dt>

<dd>
<p>This is enabled by default. It prevents the Cache Manager from synchronizing its clock with the clock on a server machine selected at random by checking the time on the server machine every five minutes. This is the recommended behavior; instead of the AFS Cache Manager, the Network Time Protocol Daemon should be used to synchronize the system time.</p>

<dt><a name="-prealloc_&#60;number_of_preallocated_blocks&#62;"
><b>-prealloc</b> &#60;<i>number of preallocated blocks</i>&#62;</a></dt>

<dd>
<p>Specifies the number of pieces of memory to preallocate for the Cache Manager&#39;s internal use. The default initial value is <code>400</code>, but the Cache Manager dynamically allocates more memory as it needs it.</p>

<dt><a name="-rmtsys"
><b>-rmtsys</b></a></dt>

<dd>
<p>Initializes an additional daemon to execute AFS-specific system calls on behalf of NFS client machines. Use this flag only if the machine is an NFS/AFS translator machine serving users of NFS client machines who execute AFS commands.</p>

<dt><a name="-rootvol_&#60;name_of_AFS_root_volume&#62;"
><b>-rootvol</b> &#60;<i>name of AFS root volume</i>&#62;</a></dt>

<dd>
<p>Names the read/write volume corresponding to the root directory for the AFS file tree (which is usually the <em>/afs</em> directory). This value overrides the default of the <code>root.afs</code> volume. This option is ignored if <b>-dynroot</b> is given.</p>

<dt><a name="-rxbind"
><b>-rxbind</b></a></dt>

<dd>
<p>Bind the Rx socket (one interface only).</p>

<dt><a name="-rxpck_&#60;value_for_rx_extraPackets&#62;"
><b>-rxpck</b> &#60;<i>value for rx_extraPackets</i>&#62;</a></dt>

<dd>
<p>Set rx_extraPackets to this value. This sets the number of extra Rx packet structures that are available to handle Rx connections. This value should be increased if the &#34;rxdebug 127.0.0.1 -port 7001 -rxstats&#34; command shows no free Rx packets. Increasing this value may improve OpenAFS client performance in some circumstances.</p>

<dt><a name="-settime"
><b>-settime</b></a></dt>

<dd>
<p>Enable native AFS time synchronization. This option is the opposite of <b>-nosettime</b> and cannot be used with the <b>-nosettime</b> option.</p>

<dt><a name="-shutdown"
><b>-shutdown</b></a></dt>

<dd>
<p>Shuts down the Cache Manager. Before calling <b>afsd</b> with this option, unmount the AFS file system with <b>umount</b>.</p>

<dt><a name="-splitcache_&#60;RW/RO_Ratio&#62;"
><b>-splitcache</b> &#60;<i>RW/RO Ratio</i>&#62;</a></dt>

<dd>
<p>This allows the user to set a certain percentage of the AFS cache be reserved for read/write content and the rest to be reserved for read-only content. The ratio should be written as a fraction. For example, <code>-splitcache 75/25</code> devotes 75% of your cache space to read/write content and 25% to read-only.</p>

<dt><a name="-stat_&#60;number_of_stat_entries&#62;"
><b>-stat</b> &#60;<i>number of stat entries</i>&#62;</a></dt>

<dd>
<p>Specifies the number of entries to allocate in the machine&#39;s memory for recording status information about the AFS files in the cache. This value overrides the default of <code>300</code>.</p>

<dt><a name="-verbose"
><b>-verbose</b></a></dt>

<dd>
<p>Generates a detailed trace of the <b>afsd</b> program&#39;s actions on the standard output stream.</p>

<dt><a name="-volumes_&#60;number_of_volume_entries&#62;"
><b>-volumes</b> &#60;<i>number of volume entries</i>&#62;</a></dt>

<dd>
<p>Specifies the number of memory structures to allocate for storing volume location information. The default value is <code>50</code>.</p>

<dt><a name="-waitclose"
><b>-waitclose</b></a></dt>

<dd>
<p>Has no effect on the operation of the Cache Manager. The behavior it affected in previous versions of the Cache Manager, to perform synchronous writes to the File Server, is now the default behavior. To perform asynchronous writes in certain cases, use the <b>fs storebehind</b> command.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The <b>afsd</b> command is normally included in the machine&#39;s AFS initialization file, rather than typed at the command shell prompt. For most disk caches, the appropriate form is</p>

<pre>   % /usr/vice/etc/afsd</pre>

<p>The following command is appropriate when enabling a machine to act as an NFS/AFS Translator machine serving more than five users.</p>

<pre>   % /usr/vice/etc/afsd -daemons 4 -rmtsys</pre>

<p>The following command initializes a memory cache and sets chunk size to 16 KB (2^14).</p>

<pre>   % /usr/vice/etc/afsd -memcache -chunksize 14</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be logged in as the local superuser root.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../1/fs_newcell.html" class="podlinkpod"
>fs_newcell(1)</a>, <a href="../5/afs_cache.html" class="podlinkpod"
>afs_cache(5)</a>, <a href="../5/CellServDB.html" class="podlinkman"
>CellServDB(5)</a>, <a href="../5/cacheinfo.html" class="podlinkman"
>cacheinfo(5)</a></p>

<p>RFC 1183 <a href="http://www.faqs.org/rfcs/rfc1183.html" class="podlinkurl"
>http://www.faqs.org/rfcs/rfc1183.html</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
