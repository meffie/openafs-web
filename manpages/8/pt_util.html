<html><head><title>pt_util</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Tue Nov 11 07:45:50 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="indexlink"><a href="../index.html">Back to Index</a></p>
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>pt_util - Load or dump a Protection Server database</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>pt_util</b> [<b>-w</b>] [<b>-user</b>] [<b>-group</b>] [<b>-members</b>] [<b>-name</b>] [<b>-system</b>] [<b>-xtra</b>] [<b>-prdb</b>&#160;&#60;<i>prdb&#160;file</i>&#62;] [<b>-datafile</b>&#160;&#60;<i>data&#160;file</i>&#62;] [<b>-help</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>pt_util</b> command can be used to load or dump the protection database.
It should only be used when <b>ptserver</b> is not running.</p>

<p>The most likely reason to use it is to initialize the protection database when bringing up a new cell.
The current syntax for this,
presented below,
needs improvement.
<b>pt_util</b> can also be used when problems are suspected with the database.
It can be used to dump the database or portions thereof,
in several different ways,
and to reload it.</p>

<p>The textual representation of the database has the following form: For users,</p>

<pre>    name flags/quota viceid ownerid creatorid</pre>

<p>For groups,</p>

<pre>    name flags/quota viceid ownerid creatorid
     a-username a-user-viceid</pre>

<p>The second line is repeated for each member of the group. When reading the database, membership is not reported unless <b>-members</b> is also included.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<p>If you don&#39;t specify any options, the only thing you&#39;ll learn is the ubik database epoch and version.</p>

<dl>
<dt><a name="-w"
><b>-w</b></a></dt>

<dd>
<p>Write to the protection database instead of reading. Only the file arguments make sense in combination with this argument.</p>

<dt><a name="-user"
><b>-user</b></a></dt>

<dd>
<p>When reading, display users.</p>

<dt><a name="-group"
><b>-group</b></a></dt>

<dd>
<p>When reading, display groups (but not necessarily members).</p>

<dt><a name="-members"
><b>-members</b></a></dt>

<dd>
<p>When reading, display groups and also group members.</p>

<dt><a name="-name"
><b>-name</b></a></dt>

<dd>
<p>When reading, follow name hashes, instead of id hashes. This may print different information if the database was corrupted. Otherwise, it should print exactly the same information, except in a different order.</p>

<dt><a name="-system"
><b>-system</b></a></dt>

<dd>
<p>When reading, display system data, or more precisely, do not display entries with a viced &#60;= -32768 or &#62;= +97537.</p>

<dt><a name="-xtra"
><b>-xtra</b></a></dt>

<dd>
<p>When reading, display extra users and groups, or more precisely, do not display entries that are in the range -32767...+97536 inclusive.</p>

<dt><a name="-prdb_&#60;prdb_file&#62;"
><b>-prdb</b> &#60;<i>prdb file</i>&#62;</a></dt>

<dd>
<p>Specifies the complete pathname of the file in which the Protection Database resides. Provide the complete name, including the ending <em>.DB0</em>.</p>

<dt><a name="-datafile_&#60;data_file&#62;"
><b>-datafile</b> &#60;<i>data file</i>&#62;</a></dt>

<dd>
<p>Specify the file to which to dump (or <b>-w</b> from which to read) textual database records.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>The file dump format does not include supergroup information, so should not be used if you have and are using groups within groups.</p>

<p>In all cases, entry timestamps and other information is also not preserved.</p>

<p>The epoch and version are reported on standard error. On little-endian machines, they&#39;ll be byte swapped, so may be very random.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following example shows how to initialize the database from scratch.</p>

<p>Before you do this, make sure <b>ptserver</b> is not running. If you have multiple database servers, make sure <em>prdb.*</em> does not exist on any server machine.</p>

<p>Now, type this in EXACTLY, including the leading space on the line indicated. But do use Control-D at the end, not up-arrow D.</p>

<pre>    pt_util -w
    admin 128/20 1 -204 -204
    system:administrators 130/20 -204 -204 -204
     admin 1
    ^D</pre>

<p>You will see this:</p>

<pre>    # pt_util -w
    pt_util: /usr/afs/db/prdb.DB0: Bad UBIK_MAGIC. Is 0 should be 354545
    Ubik Version is: 2.0
    admin 128/20 1 -204 -204
    system:administrators 130/20 -204 -204 -204
    Error while creating system:administrators: Entry for id already exists
     admin 1
    pt_util: Ubik Version number changed during execution.
    Old Version = 2.0, new version = 33554432.0
    #</pre>

<p>To make a complete copy of the database,</p>

<pre>    # pt_util -user -members -datafile /tmp/out</pre>

<p>To load from the complete copy,</p>

<pre>    # pt_util -w -datafile /tmp/out</pre>

<p>Don&#39;t do this until you read cautions, above.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be logged in as the superuser <code>root</code> on a file server machine to use <b>pt_util</b>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/prdb.DB0.html" class="podlinkpod"
>prdb.DB0(5)</a>, <a href="../8/ptserver.html" class="podlinkman"
>ptserver(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>The following copyright covers this documentation:</p>

<p>Copyright (c) 2005 The Regents of the University of Michigan. ALL RIGHTS RESERVED.</p>

<p>Permission is granted to use, copy, create derivative works and redistribute this software and such derivative works for any purpose, so long as the name of the University of Michigan is not used in any advertising or publicity pertaining to the use or distribution of this software without specific, written prior authorization. If the above copyright notice or any other identification of the University of Michigan is included in any copy of any portion of this software, then the disclaimer below must also be included.</p>

<p>This software is provided as is, without representation from the University of Michigan as to its fitness for any purpose, and without warranty by the University of Michigan of any kind, either express or implied, including without limitation the implied warranties of merchantability and fitness for a particular purpose. The regents of the University of Michigan shall not be liable for any damages, including special, indirect, incidental, or consequential damages, with respect to any claim arising out of or in connection with the use of the software, even if it has been or is hereafter advised of the possibility of such damages.</p>
<p class="indexlink"><a href="../index.html">Back to Index</a></p>

<!-- end doc -->

</body></html>
