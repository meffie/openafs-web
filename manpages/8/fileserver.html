<html><head><title>fileserver</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Sat Jul 12 06:02:33 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>fileserver - Initializes the File Server component of the fs process</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>fileserver</b> [<b>-auditlog</b>&#160;&#60;<i>path&#160;to&#160;log&#160;file</i>&#62;] [<b>-d</b>&#160;&#60;<i>debug&#160;level</i>&#62;] [<b>-p</b>&#160;&#60;<i>number&#160;of&#160;processes</i>&#62;] [<b>-spare</b>&#160;&#60;<i>number&#160;of&#160;spare&#160;blocks</i>&#62;] [<b>-pctspare</b>&#160;&#60;<i>percentage&#160;spare</i>&#62;] [<b>-b</b>&#160;&#60;<i>buffers</i>&#62;] [<b>-l</b>&#160;&#60;<i>large&#160;vnodes</i>&#62;] [<b>-s</b>&#160;&#60;<i>small&#160;vnodes</i>&#62;] [<b>-vc</b>&#160;&#60;<i>volume&#160;cachesize</i>&#62;] [<b>-w</b>&#160;&#60;<i>call&#160;back&#160;wait&#160;interval</i>&#62;] [<b>-cb</b>&#160;&#60;<i>number&#160;of&#160;call&#160;backs</i>&#62;] [<b>-banner</b>] [<b>-novbc</b>] [<b>-implicit</b>&#160;&#60;<i>admin&#160;mode&#160;bits:&#160;rlidwka</i>&#62;] [<b>-readonly</b>] [<b>-hr</b>&#160;&#60;<i>number&#160;of&#160;hours&#160;between&#160;refreshing&#160;the&#160;host&#160;cps</i>&#62;] [<b>-busyat</b>&#160;&#60;<i>redirect&#160;clients&#160;when&#160;queue&#160;&#62;&#160;n</i>&#62;] [<b>-nobusy</b>] [<b>-rxpck</b>&#160;&#60;<i>number&#160;of&#160;rx&#160;extra&#160;packets</i>&#62;] [<b>-rxdbg</b>] [<b>-rxdbge</b>] [<b>-rxmaxmtu</b>&#160;&#60;<i>bytes</i>&#62;] [<b>-nojumbo</b> [<b>-rxbind</b> [<b>-allow-dotted-principals</b>] [<b>-L</b>] [<b>-S</b>] [<b>-k</b>&#160;&#60;<i>stack&#160;size</i>&#62;] [<b>-realm</b>&#160;&#60;<i>Kerberos&#160;realm&#160;name</i>&#62;] [<b>-udpsize</b>&#160;&#60;<i>size&#160;of&#160;socket&#160;buffer&#160;in&#160;bytes</i>&#62;] [<b>-sendsize</b>&#160;&#60;<i>size&#160;of&#160;send&#160;buffer&#160;in&#160;bytes</i>&#62;] [<b>-abortthreshold</b>&#160;&#60;<i>abort&#160;threshold</i>&#62;] [<b>-enable_peer_stats</b>] [<b>-enable_process_stats</b>] [<b>-syslog</b>&#160;[&#60;<i>&#160;loglevel&#160;</i>&#62;]] [<b>-mrafslogs</b>] [<b>-saneacls</b>] [<b>-help</b>] [<b>-fs-state-dont-save</b>] [<b>-fs-state-dont-restore</b>] [<b>-fs-state-verify</b>]&#160;(none&#160;|&#160;save&#160;|&#160;restore&#160;|&#160;both)] [<b>-vhashsize</b>&#160;&#60;<i>log(2)&#160;of&#160;number&#160;of&#160;volume&#160;hash&#160;buckets</i>&#62;] [<b>-vlrudisable</b>] [<b>-vlruthresh</b>&#160;&#60;<i>minutes&#160;before&#160;unused&#160;volumes&#160;become&#160;eligible&#160;for&#160;soft&#160;detach</i>&#62;] [<b>-vlruinterval</b>&#160;&#60;<i>seconds&#160;between&#160;VLRU&#160;scans</i>&#62;] [<b>-vlrumax</b>&#160;&#60;<i>max&#160;volumes&#160;to&#160;soft&#160;detach&#160;in&#160;one&#160;VLRU&#160;scan</i>&#62;] [<b>-vattachpar</b>&#160;&#60;<i>number&#160;of&#160;volume&#160;attach&#160;threads</i>&#62;] [<b>-m</b>&#160;&#60;<i>min&#160;percentage&#160;spare&#160;in&#160;partition</i>&#62;] [<b>-lock</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>fileserver</b> command initializes the File Server component of the <code>fs</code> process.
In the conventional configuration,
its binary file is located in the <em>/usr/afs/bin</em> directory on a file server machine.</p>

<p>The <b>fileserver</b> command is not normally issued at the command shell prompt,
but rather placed into a database server machine&#39;s <em>/usr/afs/local/BosConfig</em> file with the <b>bos create</b> command.
If it is ever issued at the command shell prompt,
the issuer must be logged onto a file server machine as the local superuser <code>root</code>.</p>

<p>The File Server creates the <em>/usr/afs/logs/FileLog</em> log file as it initializes,
if the file does not already exist.
It does not write a detailed trace by default,
but the <b>-d</b> option may be used to increase the amount of detail.
Use the <b>bos getlog</b> command to display the contents of the log file.</p>

<p>The command&#39;s arguments enable the administrator to control many aspects of the File Server&#39;s performance,
as detailed in <a href="./OPTIONS.html" class="podlinkpod"
>OPTIONS</a>.
By default the <b>fileserver</b> command sets values for many arguments that are suitable for a medium-sized file server machine.
To set values suitable for a small or large file server machine,
use the <b>-S</b> or <b>-L</b> flag respectively.
The following list describes the parameters and corresponding argument for which the <b>fileserver</b> command sets default values,
and the table below summarizes the setting for each of the three machine sizes.</p>

<ul><li><p>The maximum number of lightweight processes (LWPs) or pthreads the File Server uses to handle requests for data; corresponds to the <b>-p</b> argument.
The File Server always uses a minimum of 32 KB of memory for these processes.</p></li><li><p>The maximum number of directory blocks the File Server caches in memory; corresponds to the <b>-b</b> argument.
Each cached directory block (buffer) consumes 2,092 bytes of memory.</p></li><li><p>The maximum number of large vnodes the File Server caches in memory for tracking directory elements; corresponds to the <b>-l</b> argument.
Each large vnode consumes 292 bytes of memory.</p></li><li><p>The maximum number of small vnodes the File Server caches in memory for tracking file elements; corresponds to the <b>-s</b> argument.
Each small vnode consumes 100 bytes of memory.</p></li><li><p>The maximum volume cache size,
which determines how many volumes the File Server can cache in memory before having to retrieve data from disk; corresponds to the <b>-vc</b> argument.</p></li><li><p>The maximum number of callback structures the File Server caches in memory; corresponds to the <b>-cb</b> argument.
Each callback structure consumes 16 bytes of memory.</p></li><li><p>The maximum number of Rx packets the File Server uses; corresponds to the <b>-rxpck</b> argument.
Each packet consumes 1544 bytes of memory.</p></li></ul>

<p>The default values are:</p>

<pre>  Parameter (Argument)               Small (-S)     Medium   Large (-L)
  ---------------------------------------------------------------------
  Number of LWPs (-p)                        6           9           12
  Number of cached dir blocks (-b)          70          90          120
  Number of cached large vnodes (-l)       200         400          600
  Number of cached small vnodes (-s)       200         400          600
  Maximum volume cache size (-vc)          200         400          600
  Number of callbacks (-cb)             20,000      60,000       64,000
  Number of Rx packets (-rxpck)            100         150          200</pre>

<p>To override any of the values, provide the indicated argument (which can be combined with the <b>-S</b> or <b>-L</b> flag).</p>

<p>The amount of memory required for the File Server varies. The approximate default memory usage is 751 KB when the <b>-S</b> flag is used (small configuration), 1.1 MB when all defaults are used (medium configuration), and 1.4 MB when the <b>-L</b> flag is used (large configuration). If additional memory is available, increasing the value of the <b>-cb</b> and <b>-vc</b> arguments can improve File Server performance most directly.</p>

<p>By default, the File Server allows a volume to exceed its quota by 1 MB when an application is writing data to an existing file in a volume that is full. The File Server still does not allow users to create new files in a full volume. To change the default, use one of the following arguments:</p>

<ul><li><p>Set the <b>-spare</b> argument to the number of extra kilobytes that the File Server allows as overage. A value of <code>0</code> allows no overage.</p></li><li><p>Set the <b>-pctspare</b> argument to the percentage of the volume&#39;s quota the File Server allows as overage.</p></li></ul>

<p>By default, the File Server implicitly grants the <code>a</code> (administer) and <code>l</code> (lookup) permissions to system:administrators on the access control list (ACL) of every directory in the volumes stored on its file server machine. In other words, the group&#39;s members can exercise those two permissions even when an entry for the group does not appear on an ACL. To change the set of default permissions, use the <b>-implicit</b> argument.</p>

<p>The File Server maintains a <i>host current protection subgroup</i> (<i>host CPS</i>) for each client machine from which it has received a data access request. Like the CPS for a user, a host CPS lists all of the Protection Database groups to which the machine belongs, and the File Server compares the host CPS to a directory&#39;s ACL to determine in what manner users on the machine are authorized to access the directory&#39;s contents. When the <b>pts adduser</b> or <b>pts removeuser</b> command is used to change the groups to which a machine belongs, the File Server must recompute the machine&#39;s host CPS in order to notice the change. By default, the File Server contacts the Protection Server every two hours to recompute host CPSs, implying that it can take that long for changed group memberships to become effective. To change this frequency, use the <b>-hr</b> argument.</p>

<p>The File Server stores volumes in partitions. A partition is a filesystem or directory on the server machine that is named <code>/vicepX</code> or <code>/vicepXX</code> where XX is &#34;a&#34; through &#34;z&#34; or &#34;aa&#34; though &#34;zz&#34;. The File Server expects that the /vicepXX directories are each on a dedicated filesystem. The File Server will only use a /vicepXX if it&#39;s a mountpoint for another filesystem, unless the file <code>/vicepXX/AlwaysAttach</code> exists. The data in the partition is a special format that can only be access using OpenAFS commands or an OpenAFS client.</p>

<p>The File Server generates the following message when a partition is nearly full:</p>

<pre>   No space left on device</pre>

<p>This command does not use the syntax conventions of the AFS command suites. Provide the command name and all option names in full.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>Do not use the <b>-k</b> and <b>-w</b> arguments, which are intended for use by the OpenAFS developers only. Changing them from their default values can result in unpredictable File Server behavior. In any case, on many operating systems the File Server uses native threads rather than the LWP threads, so using the <b>-k</b> argument to set the number of LWP threads has no effect.</p>

<p>Do not specify both the <b>-spare</b> and <b>-pctspare</b> arguments. Doing so causes the File Server to exit, leaving an error message in the <em>/usr/afs/logs/FileLog</em> file.</p>

<p>Options that are available only on some system types, such as the <b>-m</b> and <b>-lock</b> options, appear in the output generated by the <b>-help</b> option only on the relevant system type.</p>

<p>Currently, the maximum size of a volume is 2 terabytes (2^31 bytes) and the maximum size of a /vicepX partition on a fileserver is 2^64 kilobytes. The fileserver will not report an error when it has access to a partition larger than 2^64 kilobytes, but it will probably fail if the administrator attempts to use more than 2^64 kilobytes of space. In addition, there are reports of erroneous disk usage numbers when <b>vos partinfo</b> or other OpenAFS disk reporting tools are used with partitions larger than 2^64 kilobytes.</p>

<p>The maximum number of directory entries is 64,000 if all of the entries have names that are 15 characters or less in length. A name that is 15 characters long requires the use of only one block in the directory. Additional sequential blocks are required to store entries with names that are longer than 15 characters. Each additional block provides an additional length of 32 characters for the name of the entry.</p>

<p>In real world use, the maximum number of objects in an AFS directory is usually between 16,000 and 25,000, depending on the average name length.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-auditlog_&#60;log_path&#62;"
><b>-auditlog</b> &#60;<i>log path</i>&#62;</a></dt>

<dd>
<p>Set and enable auditing.</p>

<dt><a name="-d_&#60;debug_level&#62;"
><b>-d</b> &#60;<i>debug level</i>&#62;</a></dt>

<dd>
<p>Sets the detail level for the debugging trace written to the <em>/usr/afs/logs/FileLog</em> file. Provide one of the following values, each of which produces an increasingly detailed trace: <code>0</code>, <code>1</code>, <code>5</code>, <code>25</code>, and <code>125</code>. The default value of <code>0</code> produces only a few messages.</p>

<dt><a name="-p_&#60;number_of_processes&#62;"
><b>-p</b> &#60;<i>number of processes</i>&#62;</a></dt>

<dd>
<p>Sets the number of threads (or LWPs) to run. Provide a positive integer. The File Server creates and uses five threads for special purposes, in addition to the number specified (but if this argument specifies the maximum possible number, the File Server automatically uses five of the threads for its own purposes).</p>

<p>The maximum number of threads can differ in each release of AFS. Consult the <i>IBM AFS Release Notes</i> for the current release.</p>

<dt><a name="-spare_&#60;number_of_spare_blocks&#62;"
><b>-spare</b> &#60;<i>number of spare blocks</i>&#62;</a></dt>

<dd>
<p>Specifies the number of additional kilobytes an application can store in a volume after the quota is exceeded. Provide a positive integer; a value of <code>0</code> prevents the volume from ever exceeding its quota. Do not combine this argument with the <b>-pctspare</b> argument.</p>

<dt><a name="-pctspare_&#60;percentage_spare&#62;"
><b>-pctspare</b> &#60;<i>percentage spare</i>&#62;</a></dt>

<dd>
<p>Specifies the amount by which the File Server allows a volume to exceed its quota, as a percentage of the quota. Provide an integer between <code>0</code> and <code>99</code>. A value of <code>0</code> prevents the volume from ever exceeding its quota. Do not combine this argument with the <b>-spare</b> argument.</p>

<dt><a name="-b_&#60;buffers&#62;"
><b>-b</b> &#60;<i>buffers</i>&#62;</a></dt>

<dd>
<p>Sets the number of directory buffers. Provide a positive integer.</p>

<dt><a name="-l_&#60;large_vnodes&#62;"
><b>-l</b> &#60;<i>large vnodes</i>&#62;</a></dt>

<dd>
<p>Sets the number of large vnodes available in memory for caching directory elements. Provide a positive integer.</p>

<dt><a name="-s_&#60;small_nodes&#62;"
><b>-s</b> &#60;<i>small nodes</i>&#62;</a></dt>

<dd>
<p>Sets the number of small vnodes available in memory for caching file elements. Provide a positive integer.</p>

<dt><a name="-vc_&#60;volume_cachesize&#62;"
><b>-vc</b> &#60;<i>volume cachesize</i>&#62;</a></dt>

<dd>
<p>Sets the number of volumes the File Server can cache in memory. Provide a positive integer.</p>

<dt><a name="-w_&#60;call_back_wait_interval&#62;"
><b>-w</b> &#60;<i>call back wait interval</i>&#62;</a></dt>

<dd>
<p>Sets the interval at which the daemon spawned by the File Server performs its maintenance tasks. Do not use this argument; changing the default value can cause unpredictable behavior.</p>

<dt><a name="-cb_&#60;number_of_callbacks&#62;"
><b>-cb</b> &#60;<i>number of callbacks</i>&#62;</a></dt>

<dd>
<p>Sets the number of callbacks the File Server can track. Provide a positive integer.</p>

<dt><a name="-banner"
><b>-banner</b></a></dt>

<dd>
<p>Prints the following banner to <em>/dev/console</em> about every 10 minutes.</p>

<pre>   File Server is running at I&#60;time&#62;.</pre>

<dt><a name="-novbc"
><b>-novbc</b></a></dt>

<dd>
<p>Prevents the File Server from breaking the callbacks that Cache Managers hold on a volume that the File Server is reattaching after the volume was offline (as a result of the <b>vos restore</b> command, for example). Use of this flag is strongly discouraged.</p>

<dt><a name="-implicit_&#60;admin_mode_bits&#62;"
><b>-implicit</b> &#60;<i>admin mode bits</i>&#62;</a></dt>

<dd>
<p>Defines the set of permissions granted by default to the system:administrators group on the ACL of every directory in a volume stored on the file server machine. Provide one or more of the standard permission letters (<code>rlidwka</code>) and auxiliary permission letters (<code>ABCDEFGH</code>), or one of the shorthand notations for groups of permissions (<code>all</code>, <code>none</code>, <code>read</code>, and <code>write</code>). To review the meaning of the permissions, see the <b>fs setacl</b> reference page.</p>

<dt><a name="-readonly"
><b>-readonly</b></a></dt>

<dd>
<p>Don&#39;t allow writes to this fileserver.</p>

<dt><a name="-hr_&#60;number_of_hours_between_refreshing_the_host_cps&#62;"
><b>-hr</b> &#60;<i>number of hours between refreshing the host cps</i>&#62;</a></dt>

<dd>
<p>Specifies how often the File Server refreshes its knowledge of the machines that belong to protection groups (refreshes the host CPSs for machines). The File Server must update this information to enable users from machines recently added to protection groups to access data for which those machines now have the necessary ACL permissions.</p>

<dt><a name="-busyat_&#60;redirect_clients_when_queue_&#62;_n&#62;"
><b>-busyat</b> &#60;<i>redirect clients when queue &#62; n</i>&#62;</a></dt>

<dd>
<p>Defines the number of incoming RPCs that can be waiting for a response from the File Server before the File Server returns the error code <code>VBUSY</code> to the Cache Manager that sent the latest RPC. In response, the Cache Manager retransmits the RPC after a delay. This argument prevents the accumulation of so many waiting RPCs that the File Server can never process them all. Provide a positive integer. The default value is <code>600</code>.</p>

<dt><a name="-rxpck_&#60;number_of_rx_extra_packets&#62;"
><b>-rxpck</b> &#60;<i>number of rx extra packets</i>&#62;</a></dt>

<dd>
<p>Controls the number of Rx packets the File Server uses to store data for incoming RPCs that it is currently handling, that are waiting for a response, and for replies that are not yet complete. Provide a positive integer.</p>

<dt><a name="-rxdbg"
><b>-rxdbg</b></a></dt>

<dd>
<p>Writes a trace of the File Server&#39;s operations on Rx packets to the file <em>/usr/afs/logs/rx_dbg</em>.</p>

<dt><a name="-rxdbge"
><b>-rxdbge</b></a></dt>

<dd>
<p>Writes a trace of the File Server&#39;s operations on Rx events (such as retransmissions) to the file <em>/usr/afs/logs/rx_dbg</em>.</p>

<dt><a name="-rxmaxmtu_&#60;bytes&#62;"
><b>-rxmaxmtu</b> &#60;<i>bytes</i>&#62;</a></dt>

<dd>
<p>Defines the maximum size of an MTU. The value must be between the minimum and maximum packet data sizes for Rx.</p>

<dt><a name="-nojumbo"
><b>-nojumbo</b></a></dt>

<dd>
<p>Do not send, and do not accept, jumbograms.</p>

<dt><a name="-rxbind"
><b>-rxbind</b></a></dt>

<dd>
<p>Force the fileserver to only bind to one IP address.</p>

<dt><a name="-allow-dotted-principal"
><b>-allow-dotted-principal</b></a></dt>

<dd>
<p>By default, the RXKAD security layer will disallow access by Kerberos principals with a dot in the first component of their name. This is to avoid the confusion where principals user/admin and user.admin are both mapped to the user.admin PTS entry. Sites whose Kerberos realms don&#39;t have these collisions between principal names may disable this check by starting the server with this option.</p>

<dt><a name="-L"
><b>-L</b></a></dt>

<dd>
<p>Sets values for many arguments in a manner suitable for a large file server machine. Combine this flag with any option except the <b>-S</b> flag; omit both flags to set values suitable for a medium-sized file server machine.</p>

<dt><a name="-S"
><b>-S</b></a></dt>

<dd>
<p>Sets values for many arguments in a manner suitable for a small file server machine. Combine this flag with any option except the <b>-L</b> flag; omit both flags to set values suitable for a medium-sized file server machine.</p>

<dt><a name="-k_&#60;stack_size&#62;"
><b>-k</b> &#60;<i>stack size</i>&#62;</a></dt>

<dd>
<p>Sets the LWP stack size in units of 1 kilobyte. Do not use this argument, and in particular do not specify a value less than the default of <code>24</code>.</p>

<dt><a name="-realm_&#60;Kerberos_realm_name&#62;"
><b>-realm</b> &#60;<i>Kerberos realm name</i>&#62;</a></dt>

<dd>
<p>Defines the Kerberos realm name for the File Server to use. If this argument is not provided, it uses the realm name corresponding to the cell listed in the local <em>/usr/afs/etc/ThisCell</em> file.</p>

<dt><a name="-udpsize_&#60;size_of_socket_buffer_in_bytes&#62;"
><b>-udpsize</b> &#60;<i>size of socket buffer in bytes</i>&#62;</a></dt>

<dd>
<p>Sets the size of the UDP buffer, which is 64 KB by default. Provide a positive integer, preferably larger than the default.</p>

<dt><a name="-sendsize_&#60;size_of_send_buffer_in_bytes&#62;"
><b>-sendsize</b> &#60;<i>size of send buffer in bytes</i>&#62;</a></dt>

<dd>
<p>Sets the size of the send buffer, which is 16384 bytes by default.</p>

<dt><a name="-abortthreshold_&#60;abort_threshold&#62;"
><b>-abortthreshold</b> &#60;<i>abort threshold</i>&#62;</a></dt>

<dd>
<p>Sets the abort threshold, which is triggered when an AFS client sends a number of FetchStatus requests in a row and all of them fail due to access control or some other error. When the abort threshold is reached, the file server starts to slow down the responses to the problem client in order to reduce the load on the file server.</p>

<p>The throttling behaviour can cause issues especially for some versions of the Windows OpenAFS client. When using Windows Explorer to navigate the AFS directory tree, directories with only &#34;look&#34; access for the current user may load more slowly because of the throttling. This is because the Windows OpenAFS client sends FetchStatus calls one at a time instead of in bulk like the Unix Open AFS client.</p>

<p>Setting the threshold to 0 disables the throttling behavior. This option is available in OpenAFS versions 1.4.1 and later.</p>

<dt><a name="-enable_peer_stats"
><b>-enable_peer_stats</b></a></dt>

<dd>
<p>Activates the collection of Rx statistics and allocates memory for their storage. For each connection with a specific UDP port on another machine, a separate record is kept for each type of RPC (FetchFile, GetStatus, and so on) sent or received. To display or otherwise access the records, use the Rx Monitoring API.</p>

<dt><a name="-enable_process_stats"
><b>-enable_process_stats</b></a></dt>

<dd>
<p>Activates the collection of Rx statistics and allocates memory for their storage. A separate record is kept for each type of RPC (FetchFile, GetStatus, and so on) sent or received, aggregated over all connections to other machines. To display or otherwise access the records, use the Rx Monitoring API.</p>

<dt><a name="-syslog_[&#60;loglevel]"
><b>-syslog [&#60;loglevel</b>]</a></dt>

<dd>
<p>Use syslog instead of the normal logging location for the fileserver process. If provided, log messages are at &#60;loglevel&#62; instead of the default LOG_USER.</p>

<dt><a name="-mrafslogs"
><b>-mrafslogs</b></a></dt>

<dd>
<p>Use MR-AFS (Multi-Resident) style logging. This option is deprecated.</p>

<dt><a name="-saneacls"
><b>-saneacls</b></a></dt>

<dd>
<p>Offer the SANEACLS capability for the fileserver. This option is currently unimplemented.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command. All other valid options are ignored.</p>

<dt><a name="-fs-state-dont-save"
><b>-fs-state-dont-save</b></a></dt>

<dd>
<p>When present, fileserver state will not be saved during shutdown. Default is to save state.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-fs-state-dont-restore"
><b>-fs-state-dont-restore</b></a></dt>

<dd>
<p>When present, fileserver state will not be restored during startup. Default is to restore state on startup.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-fs-state-verify_(none_|_save_|_restore_|_both)"
><b>-fs-state-verify</b> (none | save | restore | both)</a></dt>

<dd>
<p>This argument controls the behavior of the state verification mechanism. A value of <code>none</code> turns off all verification. A value of <code>save</code> only performs the verification steps prior to saving state to disk. A value of <code>restore</code> only performs the verification steps after restoring state from disk. A value of <code>both</code> performs all verifications steps both prior to save and following a restore.</p>

<p>The default is <code>both</code>.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-vhashsize_&#60;size"
><b>-vhashsize &#60;<i>size</i></b></a></dt>

<dd>
<p>The log(2) number of of volume hash buckets. Default is 8 (i.e., by default, there are 2^8 = 256 volume hash buckets).</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-vlruthresh_&#60;minutes"
><b>-vlruthresh &#60;<i>minutes</i></b></a></dt>

<dd>
<p>The number of minutes of inactivity before a volume is eligible for soft detachment. Default is 120 minutes.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-vlruinterval_&#60;seconds"
><b>-vlruinterval &#60;<i>seconds</i></b></a></dt>

<dd>
<p>The number of seconds between VLRU candidate queue scan. The default is 120 seconds.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-vlrumax_&#60;positive_integer"
><b>-vlrumax &#60;<i>positive integer</i></b></a></dt>

<dd>
<p>The maximum number of volumes which can be soft detached in a single pass of the scanner. Default is 8 volumes.</p>

<p>This option is only supported by the demand-attach file server.</p>

<dt><a name="-vattachpar_&#60;number_of_volume_attach_threads&#62;"
><b>-vattachpar</b> &#60;<i>number of volume attach threads</i>&#62;</a></dt>

<dd>
<p>The number of threads assigned to attach and detach volumes. The default is 1. Warning: many of the I/O parallism features of Demand-Attach Fileserver are turned off when the number of volume attach threads is only 1.</p>

<p>This option is only meaningful for a file server built with pthreads support.</p>

<dt><a name="-m_&#60;min_percentage_spare_in_partition&#62;"
><b>-m</b> &#60;<i>min percentage spare in partition</i>&#62;</a></dt>

<dd>
<p>Specifies the percentage of each AFS server partition that the AIX version of the File Server creates as a reserve. Specify an integer value between <code>0</code> and <code>30</code>; the default is 8%. A value of <code>0</code> means that the partition can become completely full, which can have serious negative consequences. This option is not supported on platforms other than AIX.</p>

<dt><a name="-lock"
><b>-lock</b></a></dt>

<dd>
<p>Prevents any portion of the fileserver binary from being paged (swapped) out of memory on a file server machine running the IRIX operating system. This option is not supported on platforms other than IRIX.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following <b>bos create</b> command creates an fs process on the file server machine <code>fs2.abc.com</code> that uses the large configuration size, and allows volumes to exceed their quota by 10%. Type the command on a single line:</p>

<pre>   % bos create -server fs2.abc.com -instance fs -type fs \
                -cmd &#34;/usr/afs/bin/fileserver -pctspare 10 \
                -L&#34; /usr/afs/bin/volserver /usr/afs/bin/salvager</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TROUBLESHOOTING"
>TROUBLESHOOTING</a></h1>

<p>Sending process signals to the File Server Process can change its behavior in the following ways:</p>

<pre>  Process          Signal       OS     Result
  ---------------------------------------------------------------------

  File Server      XCPU        Unix    Prints a list of client IP
                                       Addresses.

  File Server      USR2      Windows   Prints a list of client IP
                                       Addresses.

  File Server      POLL        HPUX    Prints a list of client IP
                                       Addresses.

  Any server       TSTP        Any     Increases Debug level by a power
                                       of 5 -- 1,5,25,125, etc.
                                       This has the same effect as the
                                       -d XXX command-line option.

  Any Server       HUP         Any     Resets Debug level to 0

  File Server      TERM        Any     Run minor instrumentation over
                                       the list of descriptors.

  Other Servers    TERM        Any     Causes the process to quit.

  File Server      QUIT        Any     Causes the File Server to Quit.
                                       Bos Server knows this.</pre>

<p>The basic metric of whether an AFS file server is doing well is the number of connections waiting for a thread, which can be found by running the following command:</p>

<pre>   % rxdebug &#60;server&#62; | grep waiting_for | wc -l</pre>

<p>Each line returned by <code>rxdebug</code> that contains the text &#34;waiting_for&#34; represents a connection that&#39;s waiting for a file server thread.</p>

<p>If the blocked connection count is ever above 0, the server is having problems replying to clients in a timely fashion. If it gets above 10, roughly, there will be noticable slowness by the user. The total number of connections is a mostly irrelevant number that goes essentially monotonically for as long as the server has been running and then goes back down to zero when it&#39;s restarted.</p>

<p>The most common cause of blocked connections rising on a server is some process somewhere performing an abnormal number of accesses to that server and its volumes. If multiple servers have a blocked connection count, the most likely explanation is that there is a volume replicated between those servers that is absorbing an abnormally high access rate.</p>

<p>To get an access count on all the volumes on a server, run:</p>

<pre>   % vos listvol &#60;server&#62; -long</pre>

<p>and save the output in a file. The results will look like a bunch of <b>vos examine</b> output for each volume on the server. Look for lines like:</p>

<pre>   40065 accesses in the past day (i.e., vnode references)</pre>

<p>and look for volumes with an abnormally high number of accesses. Anything over 10,000 is fairly high, but some volumes like root.cell and other volumes close to the root of the cell will have that many hits routinely. Anything over 100,000 is generally abnormally high. The count resets about once a day.</p>

<p>Another approach that can be used to narrow the possibilities for a replicated volume, when multiple servers are having trouble, is to find all replicated volumes for that server. Run:</p>

<pre>   % vos listvldb -server &#60;server&#62;</pre>

<p>where &#60;server&#62; is one of the servers having problems to refresh the VLDB cache, and then run:</p>

<pre>   % vos listvldb -server &#60;server&#62; -part &#60;partition&#62;</pre>

<p>to get a list of all volumes on that server and partition, including every other server with replicas.</p>

<p>Once the volume causing the problem has been identified, the best way to deal with the problem is to move that volume to another server with a low load or to stop any runaway programs that are accessing that volume unnecessarily. Often the volume will be enough information to tell what&#39;s going on.</p>

<p>If you still need additional information about who&#39;s hitting that server, sometimes you can guess at that information from the failed callbacks in the <em>FileLog</em> log in <em>/var/log/afs</em> on the server, or from the output of:</p>

<pre>   % /usr/afsws/etc/rxdebug &#60;server&#62; -rxstats</pre>

<p>but the best way is to turn on debugging output from the file server. (Warning: This generates a lot of output into FileLog on the AFS server.) To do this, log on to the AFS server, find the PID of the fileserver process, and do:</p>

<pre>    kill -TSTP &#60;pid&#62;</pre>

<p>where &#60;pid&#62; is the PID of the file server process. This will raise the debugging level so that you&#39;ll start seeing what people are actually doing on the server. You can do this up to three more times to get even more output if needed. To reset the debugging level back to normal, use (The following command will NOT terminate the file server):</p>

<pre>    kill -HUP &#60;pid&#62;</pre>

<p>The debugging setting on the File Server should be reset back to normal when debugging is no longer needed. Otherwise, the AFS server may well fill its disks with debugging output.</p>

<p>The lines of the debugging output that are most useful for debugging load problems are:</p>

<pre>    SAFS_FetchStatus,  Fid = 2003828163.77154.82248, Host 171.64.15.76
    SRXAFS_FetchData, Fid = 2003828163.77154.82248</pre>

<p>(The example above is partly truncated to highlight the interesting information). The Fid identifies the volume and inode within the volume; the volume is the first long number. So, for example, this was:</p>

<pre>   % vos examine 2003828163
   pubsw.matlab61                   2003828163 RW    1040060 K  On-line
       afssvr5.Stanford.EDU /vicepa 
       RWrite 2003828163 ROnly 2003828164 Backup 2003828165 
       MaxQuota    3000000 K 
       Creation    Mon Aug  6 16:40:55 2001
       Last Update Tue Jul 30 19:00:25 2002
       86181 accesses in the past day (i.e., vnode references)

       RWrite: 2003828163    ROnly: 2003828164    Backup: 2003828165
       number of sites -&#62; 3
          server afssvr5.Stanford.EDU partition /vicepa RW Site 
          server afssvr11.Stanford.EDU partition /vicepd RO Site 
          server afssvr5.Stanford.EDU partition /vicepa RO Site </pre>

<p>and from the Host information one can tell what system is accessing that volume.</p>

<p>Note that the output of <a href="../1/vos_examine.html" class="podlinkpod"
>vos_examine(1)</a> also includes the access count, so once the problem has been identified, vos examine can be used to see if the access count is still increasing. Also remember that you can run vos examine on the read-only replica (e.g., pubsw.matlab61.readonly) to see the access counts on the read-only replica on all of the servers that it&#39;s located on.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be logged in as the superuser <code>root</code> on a file server machine to issue the command at a command shell prompt. It is conventional instead to create and start the process by issuing the <b>bos create</b> command.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/BosConfig.html" class="podlinkman"
>BosConfig(5)</a>, <a href="../5/FileLog.html" class="podlinkman"
>FileLog(5)</a>, <a href="../8/bos_create.html" class="podlinkpod"
>bos_create(8)</a>, <a href="../8/bos_getlog.html" class="podlinkpod"
>bos_getlog(8)</a>, <a href="../1/fs_setacl.html" class="podlinkpod"
>fs_setacl(1)</a>, <a href="../8/salvager.html" class="podlinkman"
>salvager(8)</a>, <a href="../8/volserver.html" class="podlinkman"
>volserver(8)</a>, <a href="../1/vos_examine.html" class="podlinkpod"
>vos_examine(1)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
