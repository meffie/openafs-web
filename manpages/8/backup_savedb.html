<html><head><title>backup_savedb</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Sat Mar 29 18:17:48 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>backup_savedb - Creates a saved copy of the Backup Database</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>backup savedb</b> [<b>-portoffset</b>&#160;&#60;<i>TC&#160;port&#160;offset</i>&#62;] [<b>-archive</b>&#160;&#60;<i>date&#160;time</i>&#62;+] [<b>-localauth</b>] [<b>-cell</b>&#160;&#60;<i>cell&#160;name</i>&#62;] [<b>-help</b>]</p>

<p><b>backup sa</b> [<b>-p</b>&#160;&#60;<i>TC&#160;port&#160;offset</i>&#62;] [<b>-a</b>&#160;&#60;<i>date&#160;time</i>&#62;+] [<b>-l</b>] [<b>-c</b>&#160;&#60;<i>cell&#160;name</i>&#62;] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>backup savedb</b> command creates a backup copy of the entire Backup Database and writes it to the tape in the device controlled by the Tape Coordinator indicated with the <b>-portoffset</b> argument.
If the database is damaged (as reported by the <b>backup dbverify</b> command),
this command repairs as much of the corruption as possible as it creates the saved copy.
The Backup Server creates a dump record for the saved database in the Backup Database (but in the disk version of the database only,
not in the version written to tape).</p>

<p>If the <code>FILE YES</code> instruction appears in the <em>/usr/afs/backup/CFG_<i>device_name</i></em> file associated with the specified port offset,
then the <b>backup savedb</b> command dumps the database copy to the backup data file listed for that port offset in the Tape Coordinator&#39;s <em>/usr/afs/backup/tapeconfig</em> file,
instead of to tape.
For the sake of clarity,
the following text refers to tapes only,
but the Backup System handles backup data files in much the same way.</p>

<p>If the <b>-archive</b> flag is provided,
after writing the saved copy of the database the Backup System truncates the copy of the database on disk by deleting volume dump records with timestamps prior to the specified date and time (it does not delete the dump records created by previous <b>backup savedb</b> commands,
however).</p>

<p>If the tape to which the database copy is written has an AFS tape name,
it must be <code>Ubik_db_dump.1</code> or <code>&#60;NULL&#62;</code>.
Any permanent name is acceptable.</p>

<p>The Tape Coordinator&#39;s default response to this command is to access the first tape by invoking the <code>MOUNT</code> instruction in the local <em>/usr/afs/backup/CFG_<i>device_name</i></em> file,
or by prompting the backup operator to insert the tape if there is no <code>MOUNT</code> instruction.
However,
if the <code>AUTOQUERY NO</code> instruction appears in the <em>CFG_<i>device_name</i></em> file,
or if the issuer of the <b>butc</b> command included the <b>-noautoquery</b> flag,
the Tape Coordinator instead expects the tape to be in the device already.
If it is not,
the Tape Coordinator invokes the <code>MOUNT</code> instruction or prompts the operator.
It also invokes the <code>MOUNT</code> instruction or prompts for any additional tapes needed to complete the operation; the backup operator must arrange to provide them.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-portoffset_&#60;TC_port_offset&#62;"
><b>-portoffset</b> &#60;<i>TC port offset</i>&#62;</a></dt>

<dd>
<p>Specifies the port offset number of the Tape Coordinator handling the tapes for this operation.</p>

<dt><a name="-archive_&#60;date_time&#62;+"
><b>-archive</b> &#60;<i>date time</i>&#62;+</a></dt>

<dd>
<p>Specifies a date and time; volume dump records with earlier timestamps are deleted from the disk copy of the Backup Database after the Backup System dumps the database (a dump&#39;s timestamp appears in the <code>created</code> field of the output from the <b>backup dumpinfo</b> command).
However,
if a dump set contains any dump created after the specified date,
none of the dump records associated with the dump set are deleted.
Dump records for previous dumps of the database (created with the <b>backup savedb</b> command) are never deleted; use the <b>backup deletedump</b> command to remove them.</p>

<p>Provide one of two values:</p>

<ul><li><p>The string <code>NOW</code> to indicate the current date and time,
in which case the Backup System deletes all dump records except those for dumps of the Backup Database itself.</p></li><li><p>A date value in the format <i>mm/dd/yyyy</i> [<i>hh:MM</i>].
The month (<i>mm</i>),
day (<i>dd</i>),
and year (<i>yyyy</i>) are required,
and valid values for the year range from <code>1970</code> to <code>2037</code>; higher values are not valid because the latest possible date in the standard UNIX representation is in February 2038.
The Backup System automatically reduces any later date to the maximum value.
<p>The hour and minutes (<i>hh:MM</i>) are optional,
but if provided must be in 24-hour format (for example,
the value <code>14:36</code> represents 2:36 p.m.).
If omitted,
the time defaults to 59 seconds after midnight (00:00:59 hours).
Similarly,
the <b>backup</b> command interpreter automatically adds 59 seconds to any time value provided.
In both cases,
adding 59 seconds compensates for how the Backup Database and <b>backup dumpinfo</b> command represent dump creation times in hours and minutes only.
That is,
the Database records a creation timestamp of <code>20:55</code> for any dump created between 20:55:00 and 20:55:59.
Automatically adding 59 seconds to a time thus includes the records for all dumps created during that minute.</p>
</p></li></ul>

<dt><a name="-localauth"
><b>-localauth</b></a></dt>

<dd>
<p>Constructs a server ticket using a key from the local <em>/usr/afs/etc/KeyFile</em> file.
The <b>backup</b> command interpreter presents it to the Backup Server,
Volume Server and VL Server during mutual authentication.
Do not combine this flag with the <b>-cell</b> argument.
For more details,
see <a href="../8/backup.html" class="podlinkman"
>backup(8)</a>.</p>

<dt><a name="-cell_&#60;cell_name&#62;"
><b>-cell</b> &#60;<i>cell name</i>&#62;</a></dt>

<dd>
<p>Names the cell in which to run the command.
Do not combine this argument with the <b>-localauth</b> flag.
For more details,
see <a href="../8/backup.html" class="podlinkman"
>backup(8)</a>.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command.
All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following example writes a copy of the Backup Database to the tape device controlled by the Tape Coordinator with port offset 1:</p>

<pre>   % backup savedb -portoffset 1</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be listed in the <em>/usr/afs/etc/UserList</em> file on every machine where the Backup Server is running, or must be logged onto a server machine as the local superuser <code>root</code> if the <b>-localauth</b> flag is included.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/butc.html" class="podlinkman"
>butc(5)</a>, <a href="../8/backup.html" class="podlinkman"
>backup(8)</a>, <a href="../8/backup_dbverify.html" class="podlinkpod"
>backup_dbverify(8)</a>, <a href="../8/backup_restoredb.html" class="podlinkpod"
>backup_restoredb(8)</a>, <a href="../8/butc.html" class="podlinkman"
>butc(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
