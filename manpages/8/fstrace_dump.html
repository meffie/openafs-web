<html><head><title>fstrace_dump</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Fri Jun  6 16:43:04 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>fstrace_dump - Dumps a trace log</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>fstrace dump</b> [<b>-set</b>&#160;&#60;<i>set&#160;name</i>&#62;+] [<b>-follow</b>&#160;&#60;<i>log&#160;name</i>&#62;] [<b>-file</b>&#160;&#60;<i>output&#160;filename</i>&#62;] [<b>-sleep</b>&#160;&#60;<i>seconds&#160;between&#160;reads</i>&#62;] [<b>-help</b>]</p>

<p><b>fstrace d</b> [<b>-se</b>&#160;&#60;<i>set&#160;name</i>&#62;+] [<b>-fo</b>&#160;&#60;<i>log&#160;name</i>&#62;] [<b>-fi</b>&#160;&#60;<i>output&#160;filename</i>&#62;] [<b>-sl</b>&#160;&#60;<i>seconds&#160;between&#160;reads</i>&#62;] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>fstrace dump</b> command displays the current contents of the <code>cmfx</code> trace log on the standard output stream or writes it to the file named by the <b>-file</b> argument.</p>

<p>To write the log continuously to the standard output stream or to a file,
use the <b>-follow</b> argument.
By default,
the log&#39;s contents are written out every ten seconds and then automatically cleared.
To change the interval between writes,
use the <b>-sleep</b> argument.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>This command produces output only if the <code>cm</code> event set is active.
To display or set the event set&#39;s state,
use the <b>fstrace lsset</b> or <b>fstrace setset</b> command respectively.</p>

<p>To make the output from this command maximally readable,
the message catalog file called <em>afszcm.cat</em> must reside in the local <em>/usr/vice/etc/C</em> directory.
If necessary,
copy the file to that directory from the AFS Binary Distribution before activating tracing.</p>

<p>When the <code>cm</code> event set is active,
a defined amount of kernel memory (by default,
60 KB) is allocated for the <code>cmfx</code> trace log.
As described in <a href="../8/fstrace.html" class="podlinkman"
>fstrace(8)</a>,
when the buffer is full,
messages are overwritten in a circular fashion (new messages overwrite the oldest ones).
To allocate more kernel memory for the log,
use the <b>fstrace setlog</b> command; to display the log buffer&#39;s current size,
use the <b>fstrace lslog</b> command with the <b>-long</b> argument.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-set_&#60;set_name&#62;+"
><b>-set</b> &#60;<i>set name</i>&#62;+</a></dt>

<dd>
<p>Names the event set for which to write out the associated trace log.
The only acceptable value is <code>cm</code> (for which the associated trace log is <code>cmfx</code>).
Provide either this argument or the <b>-log</b> argument,
or omit both to write out the <code>cmfx</code> log by default.</p>

<dt><a name="-follow_&#60;log_name&#62;"
><b>-follow</b> &#60;<i>log name</i>&#62;</a></dt>

<dd>
<p>Names the trace log to write out continuously at a specified interval (by default,
every ten seconds; use the <b>-sleep</b> argument to change the interval).
The log is cleared after each write operation.</p>

<p>The only acceptable value is <code>cmfx</code>.
Provide either this argument or the <b>-set</b> argument,
or omit both to write out the <code>cmfx</code> log by default.</p>

<dt><a name="-file_&#60;output_filename&#62;"
><b>-file</b> &#60;<i>output filename</i>&#62;</a></dt>

<dd>
<p>Specifies the pathname of the file to which to write the trace log&#39;s contents.
It can be in AFS or on the local disk.
Partial pathnames are interpreted relative to the current working directory.
If this argument is omitted,
the trace log appears on the standard output stream.</p>

<dt><a name="-sleep_&#60;seconds_between_reads&#62;"
><b>-sleep</b> &#60;<i>seconds between reads</i>&#62;</a></dt>

<dd>
<p>Sets the number of seconds between writes of the trace log&#39;s contents when it is dumped continuously.
Provide the <b>-follow</b> argument along with this one.
If this argument is omitted,
the default interval is ten seconds.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command.
All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OUTPUT"
>OUTPUT</a></h1>

<p>The output begins with a header specifying the date and time at which the write operation began.
If the <b>-follow</b> argument is not included,
the header also reports the number of logs being dumped; it is always <code>1</code>,
since there is only the <code>cmfx</code> trace log.
The format of the header is as follows:</p>

<pre>   AFS Trace Dump -
     Date: I&#60;starting_timestamp&#62;
   Found 1 logs.
   Contents of log cmfx:</pre>

<p>Each subsequent message describes a Cache Manager operation in the following format:</p>

<pre>   time &#60;timestamp&#62;, pid &#60;pid&#62;:&#60;event_message&#62;</pre>

<p>where</p>

<dl>
<dt><a name="&#60;timestamp&#62;"
>&#60;timestamp&#62;</a></dt>

<dd>
<p>Specifies the time at which the Cache Manager performed the operation, as the number of seconds since the dump began.</p>

<dt><a name="&#60;pid&#62;"
>&#60;pid&#62;</a></dt>

<dd>
<p>Specifies the process ID of the process or thread associated with the message.</p>

<dt><a name="&#60;event_message&#62;"
>&#60;event_message&#62;</a></dt>

<dd>
<p>Is the message itself. They are generally meaningful only to someone familiar with the AFS source code.</p>
</dd>
</dl>

<p>In addition, every 1024 seconds the fstrace command interpreter writes a message that records the current clock time, in the following format:</p>

<pre>   time &#60;timestamp&#62;, pid &#60;pid&#62;: Current time: &#60;unix_time&#62;</pre>

<p>where</p>

<dl>
<dt><a name="&#60;timestamp&#62;"
>&#60;timestamp&#62;</a></dt>

<dd>
<p>Is the number of seconds from the start of trace logging.</p>

<dt><a name="&#60;pid&#62;"
>&#60;pid&#62;</a></dt>

<dd>
<p>Is the process ID number.</p>

<dt><a name="&#60;unix_time&#62;"
>&#60;unix_time&#62;</a></dt>

<dd>
<p>Is the machine&#39;s clock time, represent in the standard UNIX time format as the number of seconds since midnight on January 1, 1970.</p>
</dd>
</dl>

<p>Use this message to determine the actual clock time associated with each log message. Determine the actual time as follows:</p>

<ul><li><p>Locate the message of interest.</p></li><li><p>Search backward through the trace file for the closest current time message.</p></li><li><p>If the current time message&#39;s timestamp is smaller than the log message&#39;s timestamp, subtract former from the latter. If the current time message&#39;s timestamp is larger than the log message&#39;s timestamp, add 1024 to the latter and subtract the former from the result.</p></li><li><p>Add the resulting number to the current time message&#39;s &#60;unix_time&#62; to determine the log message&#39;s actual time.
<p>If any of the data in the kernel trace buffer has been overwritten since tracing was activated, the following message appears at the appropriate place in the output:</p>

<pre>   Log wrapped; data missing.</pre>

<p>To reduce the likelihood of overwriting, use the <b>fstrace setlog</b> command to increase the kernel buffer&#39;s size. To display the current defined buffer size, use the <b>fstrace lslog</b> command with the <b>-long</b> argument.</p>

<p>The following message at the end of the log dump indicates that it is completed:</p>

<pre>   AFS Trace Dump - Completed</pre>
</p></li></ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following command dumps the log associated with the cm event set to the standard output stream.</p>

<pre>   # fstrace dump -set cm
   AFS Trace Dump -
      Date: Tue Apr  7 10:54:57 1998
   Found 1 logs.
   time 32.965783, pid 0: Tue Apr  7 10:45:52 1998
   time 32.965783, pid 33657: Close 0x5c39ed8 flags 0x20
   time 32.965897, pid 33657: Gn_close vp 0x5c39ed8 flags 0x20 (returns 0x0)
   time 35.159854, pid 10891: Breaking callback for 5bd95e4 states 1024 (volume 0)
   time 35.407081, pid 10891: Breaking callback for 5c0fadc states 1024 (volume 0)
                                    .
                                    .
                                    .
   time 71.440456, pid 33658: Lookup adp 0x5bbdcf0 name g3oCKs \
        fid (756 4fb7e:588d240.2ff978a8.6)
   time 71.440569, pid 33658: Returning code 2 from 19
   time 71.440619, pid 33658: Gn_lookup vp 0x5bbdcf0 name g3oCKs (returns 0x2)
   time 71.464989, pid 38267: Gn_open vp 0x5bbd000 flags 0x0 (returns 0x0)
   AFS Trace Dump - Completed</pre>

<p>The following command dumps the trace log associated with the cm event set on the local machine to the file <code>cmfx.dump.file.1</code>, using the default interval of 10 seconds between successive dumps:</p>

<pre>   # fstrace dump -follow cmfx -file cmfx.dump.file.1</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be logged in as the local superuser <code>root</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/afszcm.cat.html" class="podlinkpod"
>afszcm.cat(5)</a>, <a href="../8/fstrace.html" class="podlinkman"
>fstrace(8)</a>, <a href="../8/fstrace_lslog.html" class="podlinkpod"
>fstrace_lslog(8)</a>, <a href="../8/fstrace_setlog.html" class="podlinkpod"
>fstrace_setlog(8)</a>, <a href="../8/fstrace_lsset.html" class="podlinkpod"
>fstrace_lsset(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
