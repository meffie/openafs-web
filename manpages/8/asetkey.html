<html><head><title>asetkey</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Tue Nov 11 07:45:47 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="indexlink"><a href="../index.html">Back to Index</a></p>
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>asetkey - Add a key from a keytab to an AFS KeyFile</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>asetkey</b> add &#60;<i>kvno</i>&#62; &#60;<i>keyfile</i>&#62; &#60;<i>principal</i>&#62;</p>

<p><b>asetkey</b> delete &#60;<i>kvno</i>&#62;</p>

<p><b>asetkey</b> list</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>asetkey</b> command is used to add a key to an AFS KeyFile from a Kerberos keytab.
It is similar to <b>bos addkey</b> except that it must be run locally on the system where the KeyFile is located and it takes the new key from a Kerberos 5 keytab rather than prompting for the password.</p>

<p><b>asetkey delete</b> can be used to delete a key (similar to <b>bos removekeys</b>),
and <b>asetkey list</b> will list the keys in a KeyFile (similar to <b>bos listkeys</b>).</p>

<p><b>asetkey</b> is used when authentication for an AFS cell is provided by a Kerberos 5 KDC rather than <b>kaserver</b>.
The key for the <code>afs</code> or <code>afs/<i>cell name</i></code> principal in the Kerberos 5 KDC must match the key stored in the AFS KeyFile on all AFS database servers and file servers.
This is done by creating a keytab containing that key using the standard Kerberos commands (generally the <code>ktadd</code> function of the <b>kadmin</b> command) and then,
on each AFS database server and file server,
adding that key to the KeyFile with <b>asetkey add</b>.
The <i>kvno</i> chosen should match the kvno in the Kerberos KDC (checked with <b>kvno</b> or the <code>getprinc</code> function of <b>kadmin</b>).
<i>principal</i> should be the name of the AFS principal in the keytab,
which must be either <code>afs</code> or <code>afs/<i>cell name</i></code>.</p>

<p>In cells that use the Update Server to distribute the contents of the <em>/usr/afs/etc</em> directory,
it is conventional to run <b>asetkey add</b> only on the control machine and then let the Update Server propagate the new KeyFile to all other systems.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>AFS currently only supports des-cbc-crc:v4 Kerberos keys.
Make sure,
when creating the keytab with <code>ktadd</code>,
you pass <code>-e des-cbc-crc:v4</code> to force the encryption type.
Otherwise,
AFS authentication may not work.</p>

<p>As soon as a new keytab is created with <code>ktadd</code>,
new AFS service tickets will use the new key.
However,
tokens formed from those service tickets will only work if the new key is present in the KeyFile on the AFS file server.
There is therefore an outage window between when the new keytab is created and when the key had been added to the KeyFile of all AFS servers with <b>asetkey</b>,
during which newly obtained AFS tokens will not work properly.</p>

<p>All of the KeyFile entries must match the key in the Kerberos KDC,
but each time <code>ktadd</code> is run,
it creates a new key.
Either the Update Server must be used to distribute the KeyFile to all servers or the same keytab must be used with <b>asetkey</b> on each server.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following commands create a new keytab for the principal <code>afs</code> and then import the key into the KeyFile.
Note the kvno in the output from <code>ktadd</code>.</p>

<pre>    % kadmin
    Authenticating as principal rra/admin@stanford.edu with password.
    Password for rra/admin@stanford.edu:
    kadmin:  ktadd -k /tmp/afs.keytab -e des-cbc-crc:v4 afs
    Entry for principal afs with kvno 3, encryption type DES cbc mode
    with CRC-32 added to keytab WRFILE:/tmp/afs.keytab.
    kadmin:  exit
    % asetkey 3 /tmp/afs.keytab afs</pre>

<p>You may want to use <code>afs/<i>cell name</i></code> instead of <code>afs</code>, particularly if you may have multiple AFS cells for a single Kerberos realm.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be able to read (for <b>asetkey list</b>) and write (for <b>asetkey add</b> and <b>asetkey delete</b>) the KeyFile, normally <em>/usr/afs/etc/KeyFile</em>. In practice, this means that the issuer must be the local superuser <code>root</code> on the AFS file server or database server. For <b>asetkey add</b>, the issuer must also be able to read the specified keytab file.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/KeyFile.html" class="podlinkman"
>KeyFile(5)</a>, <a href="../8/bos_addkey.html" class="podlinkpod"
>bos_addkey(8)</a>, <a href="../8/bos_listkeys.html" class="podlinkpod"
>bos_listkeys(8)</a>, <a href="../8/bos_removekey.html" class="podlinkpod"
>bos_removekey(8)</a>, kadmin(8), kvno(1)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright 2006 Russ Allbery &#60;rra@stanford.edu&#62;</p>

<p>This documentation is covered by the IBM Public License Version 1.0. This man page was written by Russ Allbery for OpenAFS.</p>
<p class="indexlink"><a href="../index.html">Back to Index</a></p>

<!-- end doc -->

</body></html>
