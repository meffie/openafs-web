<html><head><title>butc</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Mon Jul 28 01:10:45 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="indexlink"><a href="../index.html">Back to Index</a></p>
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>butc - Defines Tape Coordinator instructions for automated tape devices</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <em>CFG_<i>device_name</i></em> file includes instructions that configure a Tape Coordinator (<b>butc</b>) for use with automated backup devices such as tape stackers and jukeboxes,
enable the Tape Coordinator to dump and restore data to a <i>backup data file</i> on a local disk device,
and enable greater automation of other aspects of the backup process.</p>

<p>There is a separate configuration file for each tape device or backup data file.
Creating the file is optional,
and unnecessary if none of the instructions it can include pertain to a given tape device.
The ASCII-format file must reside in the <em>/usr/afs/backup</em> directory on the Tape Coordinator machine if it exists.</p>

<p>The <em>CFG_<i>device_name</i></em> file does not replace the <em>/usr/afs/backup/tapeconfig</em> file,
a single copy of which still must exist on every Tape Coordinator machine.</p>

<p>To enable the Tape Coordinator to locate the configuration file,
construct the variable part of the filename,
<i>device_name</i>,
as follows:</p>

<ul><li><p>For a tape device,
strip off the initial <code>/dev/</code> string from the device name,
and replace any other slashes in the name with underscores.
For example,
<em>CFG_rmt_4m</em> is the appropriate filename for a device called <em>/dev/rmt/4m</em>.</p></li><li><p>For a backup data file,
strip off the initial slash (<code>/</code>) and replace any other slashes in the name with underscores.
For example,
<em>CFG_var_tmp_FILE</em> is the appropriate filename for a backup data file called <em>/var/tmp/FILE</em>.</p></li></ul>

<p>The <em>CFG_<i>device_name</i></em> file lists one or more of the following instructions,
each on its own line.
All are optional,
and they can appear in any order.
A more detailed description of each instruction follows the list:</p>

<dl>
<dt><a name="ASK"
>ASK</a></dt>

<dd>
<p>Controls whether the Tape Coordinator prompts for guidance when it encounters error conditions.</p>

<dt><a name="AUTOQUERY"
>AUTOQUERY</a></dt>

<dd>
<p>Controls whether the Tape Coordinator prompts for the first tape.</p>

<dt><a name="BUFFERSIZE"
>BUFFERSIZE</a></dt>

<dd>
<p>Sets the size of the memory buffer the Tape Coordinator uses when transferring data.</p>

<dt><a name="FILE"
>FILE</a></dt>

<dd>
<p>Controls whether the dump is written to a tape device or a file.</p>

<dt><a name="MOUNT"
>MOUNT</a></dt>

<dd>
<p>Identifies the file that contains routines for inserting tapes into the device&#39;s drive.</p>

<dt><a name="NAME_CHECK"
>NAME_CHECK</a></dt>

<dd>
<p>Controls whether the Tape Coordinator verifies that a tape&#39;s AFS tape name matches the dump being written.</p>

<dt><a name="UNMOUNT"
>UNMOUNT</a></dt>

<dd>
<p>Identifies the file that contains routines for removing tapes from the device&#39;s drive.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_ASK_Instruction"
>The ASK Instruction</a></h2>

<p>The <code>ASK</code> instruction takes a boolean value as its argument,
in the following format:</p>

<pre>   ASK (YES | NO)</pre>

<p>When the value is <code>YES</code>, the Tape Coordinator generates a prompt in its window, requesting a response to the error cases described in the following list. This is the default behavior if the <code>ASK</code> instruction does not appear in the <em>CFG_<i>device_name</i></em> file.</p>

<p>When the value is <code>NO</code>, the Tape Coordinator does not prompt in error cases, but instead uses the automatic default responses described in the following list. The Tape Coordinator also logs the error in the <em>TE_<i>device_name</i></em> file. Suppressing the prompts enables the Tape Coordinator to run unattended, though it still prompts for insertion of tapes unless the <code>MOUNT</code> instruction is used.</p>

<p>The error cases controlled by this instruction are the following:</p>

<ul><li><p>The Backup System is unable to dump a volume while running the backup dump command. With a <code>YES</code> value, the Tape Coordinator prompts to offer three choices: try to dump the volume again immediately, omit the volume from the dump but continue the operation, or terminate the operation. With a <code>NO</code> value, the Tape Coordinator omits the volume from the dump and continues the operation.</p></li><li><p>The Backup System is unable to restore a volume while running the <b>backup diskrestore</b>, <b>backup volrestore</b>, or <b>backup volsetrestore</b> command. With a <code>YES</code> value, the Tape Coordinator prompts to offer two choices: omit the volume and continue restoring the other volumes, or terminate the operation. With a <code>NO</code> value, it continues the operation without prompting, omitting the problematic volume but restoring the remaining ones.</p></li><li><p>The Backup System cannot determine if the dump set includes any more tapes, while running the <b>backup scantape</b> command (the reference page for that command discusses possible reasons for this problem). With a <code>YES</code> value, the Tape Coordinator prompts to ask if there are more tapes to scan. With a <code>NO</code> value, it proceeds as though there are more tapes and invokes the routine named by the <code>MOUNT</code> instruction in the configuration file, or prompts the operator to insert the next tape.</p></li><li><p>The Backup System determines that the tape contains an unexpired dump while running the <b>backup labeltape</b> command. With a <code>YES</code> value, the Tape Coordinator prompts to offer two choices: continue or terminate the labeling operation. With a <code>NO</code> value, it terminates the operation without relabeling the tape.</p></li></ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_AUTOQUERY_Instruction"
>The AUTOQUERY Instruction</a></h2>

<p>The <code>AUTOQUERY</code> instruction takes a boolean value as its argument, in the following format:</p>

<pre>   AUTOQUERY (YES | NO)</pre>

<p>When the value is <code>YES</code>, the Tape Coordinator checks for the <code>MOUNT</code> instruction in the configuration file when it needs to read the first tape involved in an operation. As described for that instruction, it then either prompts for the tape or invokes the specified routine to mount the tape. This is the default behavior if the <code>AUTOQUERY</code> instruction does not appear in the configuration file.</p>

<p>When the value is <code>NO</code>, the Tape Coordinator assumes that the first tape required for an operation is already in the drive. It does not prompt the operator or invoke the <code>MOUNT</code> routine unless there is an error in accessing the first tape. This setting is equivalent in effect to including the <b>-noautoquery</b> flag to the <b>butc</b> command.</p>

<p>Note that the setting of the <code>AUTOQUERY</code> instruction controls the Tape Coordinator&#39;s behavior only with respect to the first tape required for an operation. For subsequent tapes, the Tape Coordinator always checks for the <code>MOUNT</code> instruction. It also refers to the <code>MOUNT</code> instruction if it encounters an error while attempting to access the first tape.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_BUFFERSIZE_Instruction"
>The BUFFERSIZE Instruction</a></h2>

<p>The <code>BUFFERSIZE</code> instruction takes an integer value, and optionally units, in the following format:</p>

<pre>   BUFFERSIZE &#60;size&#62;[(k | K | m | M | g | G)]</pre>

<p>where &#60;size&#62; specifies the amount of memory the Tape Coordinator allocates to use as a buffer during both dump and restore operations. The default unit is bytes, but use <code>k</code> or <code>K</code> to specify kilobytes, <code>m</code> or <code>M</code> for megabytes, and <code>g</code> or <code>G</code> for gigabytes. There is no space between the &#60;size&#62; value and the units letter.</p>

<p>By default, the Tape Coordinator uses a 16 KB buffer during dump operations. As it receives volume data from the Volume Server, the Tape Coordinator gathers 16 KB of data in the buffer before transferring the entire 16 KB to the tape device or backup data file. Similarly, during a restore operation the Tape Coordinator by default buffers 32 KB of data from the tape device or backup data file before transferring the entire 32 KB to the Volume Server for restoration into the file system. Buffering makes the volume of data flowing to and from a tape device more even and so promotes tape streaming, which is the most efficient way for a tape device to operate.</p>

<p>In a normal network configuration, the default buffer sizes are usually large enough to promote tape streaming. If the network between the Tape Coordinator machine and file server machines is slow, it can help to increase the buffer size.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_FILE_Instruction"
>The FILE Instruction</a></h2>

<p>The <code>FILE</code> instruction takes a boolean value as its argument, in the following format:</p>

<pre>   FILE (NO | YES)</pre>

<p>When the value is <code>NO</code>, the Tape Coordinator writes to a tape device during a dump operation and reads from one during a restore operation. This is the default behavior if the <code>FILE</code> instruction does not appear in the configuration file.</p>

<p>When the value is <code>YES</code>, the Tape Coordinator writes volume data to a backup data file on the local disk during a dump operation and reads volume data from a file during a restore operation. If the file does not exist when the Tape Coordinator attempts to access it to write a dump, the Tape Coordinator creates it. For a restore operation to succeed, the file must exist and contain volume data previously written to it by a <b>backup dump</b> operation.</p>

<p>When the value is <code>YES</code>, the backup data file&#39;s complete pathname must appear (instead of a tape drive device name) in the third field of the corresponding port offset entry in the local <em>/usr/afs/backup/tapeconfig</em> file. If the field instead refers to a tape device, dump operations appear to succeed but are inoperative. It is not possible to restore data that was accidently dumped to a tape device while the <code>FILE</code> instruction was set to <code>YES</code>. (In the same way, if the <code>FILE</code> instruction is set to <code>NO</code>, the <em>tapeconfig</em> entry must refer to an actual tape device.)</p>

<p>Rather than put an actual file pathname in the third field of the <em>tapeconfig</em> file, however, the recommended configuration is to create a symbolic link in the <em>/dev</em> directory that points to the actual file pathname, and record the symbolic link in this field. This configuration has a couple of advantages:</p>

<ul><li><p>It makes the <i>device_name</i> portion of the <em>CFG_<i>device_name</i></em>, <em>TE_<i>device_name</i></em>, and <em>TL_<i>device_name</i></em> names as short as possible. Because the symbolic link is in the <em>/dev</em> directory as though it were a tape device, the device configuration file&#39;s name is constructed by stripping off the entire <em>/dev/</em> prefix, instead of just the initial slash. If, for example, the symbolic link is called <em>/dev/FILE</em>, the device configuration file name is <em>CFG_FILE</em>, whereas if the actual pathname <em>/var/tmp/FILE</em> appears in the <b>tapeconfig</b> file, the file&#39;s name must be <em>CFG_var_tmp_FILE</em>.</p></li><li><p>It provides for a more graceful, and potentially automated, recovery if the Tape Coordinator cannot write a complete dump into the backup data file (because the partition housing the backup data file becomes full, for example). The Tape Coordinator&#39;s reaction to this problem is to invoke the <code>MOUNT</code> script, or to prompt the operator if the <code>MOUNT</code> instruction does not appear in the configuration file.
<ul><li><p>If there is a <code>MOUNT</code> routine, the operator can prepare for this situation by adding a subroutine that changes the symbolic link to point to another backup data file on a partition where there is space available.</p></li><li><p>If there is no <code>MOUNT</code> instruction, the prompt enables the operator manually to change the symbolic link to point to another backup data file, then press Return to signal that the Tape Coordinator can continue the operation.</p></li></ul>
</p></li></ul>

<p>If the third field in the <em>tapeconfig</em> file names the actual file, there is no way to recover from exhausting the space on the partition that houses the backup data file. It is not possible to change the <em>tapeconfig</em> file in the middle of an operation.</p>

<p>When writing to a backup data file, the Tape Coordinator writes data at 16 KB offsets. If a given block of data (such as the marker that signals the beginning or end of a volume) does not fill the entire 16 KB, the Tape Coordinator still skips to the next offset before writing the next block. In the output of a <b>backup dumpinfo</b> command issued with the <b>-id</b> option, the value in the <code>Pos</code> column is the ordinal of the 16-KB offset at which the volume data begins, and so is not generally only one higher than the position number on the previous line, as it is for dumps to tape.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_MOUNT_Instruction"
>The MOUNT Instruction</a></h2>

<p>The <code>MOUNT</code> instruction takes a pathname as its argument, in the following format:</p>

<pre>   MOUNT &#60;filename&#62;</pre>

<p>The referenced executable file must reside on the local disk and contain a shell script or program that directs an automated tape device, such as a jukebox or stacker, to mount a tape (insert it into the tape reader). The operator must write the routine to invoke the mount command specified by the device&#39;s manufacturer; AFS does not include any scripts, although an example appears in <a href="./EXAMPLES.html" class="podlinkpod"
>EXAMPLES</a>. The script or program inherits the Tape Coordinator&#39;s AFS authentication status.</p>

<p>When the Tape Coordinator needs to mount a tape, it checks the configuration file for a <code>MOUNT</code> instruction. If there is no <code>MOUNT</code> instruction, the Tape Coordinator prompts the operator to insert a tape before it attempts to open the tape device. If there is a <code>MOUNT</code> instruction, the Tape Coordinator executes the routine in the referenced file. The routine invoked by the <code>MOUNT</code> instruction inherits the local identity (UNIX UID) and AFS tokens of the <b>butc</b> command&#39;s issuer.</p>

<p>There is an exception to this sequence: if the <code>AUTOQUERY NO</code> instruction appears in the configuration file, or the <b>-noautoquery</b> flag was included on the <b>butc</b> command, then the Tape Coordinator assumes that the operator has already inserted the first tape needed for a given operation. It attempts to read the tape immediately, and only checks for the <code>MOUNT</code> instruction or prompts the operator if the tape is missing or is not the required one.</p>

<p>When the Tape Coordinator invokes the routine indicated by the <code>MOUNT</code> instruction, it passes the following parameters to the routine in the indicated order:</p>

<ul><li><p>The tape device or backup data file&#39;s pathname, as recorded in the <em>/usr/afs/backup/tapeconfig</em> file.</p></li><li><p>The tape operation, which (except for the exceptions noted in the following list) matches the <b>backup</b> command operation code used to initiate the operation:
<ul><li><p><code>appenddump</code> (when a backup dump command includes the <b>-append</b> flag).</p></li><li><p><code>dump</code> (when a backup dump command does not include the <b>-append</b> flag).</p></li><li><p><code>labeltape</code></p></li><li><p><code>readlabel</code></p></li><li><p><code>restore</code> (for a <b>backup diskrestore</b>, backup volrestore, or <b>backup volsetrestore</b> command).</p></li><li><p><code>restoredb</code></p></li><li><p><code>savedb</code></p></li><li><p><code>scantape</code></p></li></ul>
</p></li><li><p>The number of times the Tape Coordinator has attempted to open the tape device or backup data file. If the open attempt returns an error, the Tape Coordinator increments this value by one and again invokes the <code>MOUNT</code> instruction.</p></li><li><p>The tape name. For some operations, the Tape Coordinator passes the string <code>none</code>, because it does not know the tape name (when running the <b>backup scantape</b> or <b>backup readlabel</b>, for example), or because the tape does not necessarily have a name (when running the <b>backup labeltape</b> command, for example).</p></li><li><p>The tape ID recorded in the Backup Database. As with the tape name, the Backup System passes the string <code>none</code> for operations where it does not know the tape ID or the tape does not necessarily have an ID.</p></li></ul>

<p>The routine invoked by the <code>MOUNT</code> instruction must return an exit code to the Tape Coordinator:</p>

<ul><li><p>Code 0 (zero) indicates that the routine successfully mounted the tape. The Tape Coordinator continues the backup operation. If the routine invoked by the <code>MOUNT</code> instruction does not return this exit code, the Tape Coordinator never calls the <code>UNMOUNT</code> instruction.</p></li><li><p>Code 1 (one) indicates that the routine failed to mount the tape. The Tape Coordinator terminates the operation.</p></li><li><p>Any other code indicates that the routine was not able to access the correct tape. The Tape Coordinator prompts the operator to insert the correct tape.</p></li></ul>

<p>If the backup command was issued in interactive mode and the operator issues the <b>backup kill</b> command while the <code>MOUNT</code> routine is running, the Tape Coordinator passes the termination signal to the routine; the entire operation terminates.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_NAME_CHECK_Instruction"
>The NAME_CHECK Instruction</a></h2>

<p>The <code>NAME_CHECK</code> instruction takes a boolean value as its argument, in the following format:</p>

<pre>   NAME_CHECK (YES | NO)</pre>

<p>When the value is <code>YES</code> and the tape does not have a permanent name, the Tape Coordinator checks the AFS tape name when dumping a volume in response to the <b>backup dump</b> command. The AFS tape name must be <code>&#60;NULL&#62;</code> or match the tape name that the <b>backup dump</b> operation assigns based on the volume set and dump level names. This is the default behavior if the <code>NAME_CHECK</code> instruction does not appear in the configuration file.</p>

<p>When the value is <code>NO</code>, the Tape Coordinator does not check the AFS tape name before writing to the tape.</p>

<p>The Tape Coordinator always checks that all dumps on the tape are expired, and refuses to write to a tape that contains unexpired dumps.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_UNMOUNT_Instruction"
>The UNMOUNT Instruction</a></h2>

<p>The <code>UNMOUNT</code> instruction takes a pathname as its argument, in the following format:</p>

<pre>   UNMOUNT &#60;filename&#62;</pre>

<p>The referenced executable file must reside on the local disk and contain a shell script or program that directs an automated tape device, such as a jukebox or stacker, to unmount a tape (remove it from the tape reader). The operator must write the routine to invoke the unmount command specified by the device&#39;s manufacturer; AFS does not include any scripts, although an example appears in <a href="./EXAMPLES.html" class="podlinkpod"
>EXAMPLES</a>. The script or program inherits the Tape Coordinator&#39;s AFS authentication status.</p>

<p>After closing a tape device, the Tape Coordinator checks the configuration file for an <code>UNMOUNT</code> instruction, whether or not the <b>close</b> operation succeeds. If there is no <code>UNMOUNT</code> instruction, the Tape Coordinator takes no action, in which case the operator must take the action necessary to remove the current tape from the drive before another can be inserted. If there is an <code>UNMOUNT</code> instruction, the Tape Coordinator executes the referenced file. It invokes the routine only once, passing in the following parameters:</p>

<ul><li><p>The tape device pathname (as specified in the <em>/usr/afs/backup/tapeconfig</em> file).</p></li><li><p>The tape operation (always unmount).</p></li></ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The file is protected by UNIX mode bits. Creating the file requires the <code>w</code> (write) and <code>x</code> (execute) permissions on the <em>/usr/afs/backup</em> directory. Editing the file requires the <code>w</code> (write) permission on the file.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following example configuration files demonstrate one way to structure a configuration file for a stacker or backup dump file. The examples are not necessarily appropriate for a specific cell; if using them as models, be sure to adapt them to the cell&#39;s needs and equipment.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Example_CFG_device_name_File_for_Stackers"
>Example <em>CFG_<i>device_name</i></em> File for Stackers</a></h2>

<p>In this example, the administrator creates the following entry for a tape stacker called <code>stacker0.1</code> in the <em>/usr/afs/backup/tapeconfig</em> file. It has port offset 0.</p>

<pre>   2G   5K   /dev/stacker0.1   0</pre>

<p>The administrator includes the following five lines in the <em>/usr/afs/backup/CFG_stacker0.1</em> file. To review the meaning of each instruction, see <a href="./DESCRIPTION.html" class="podlinkpod"
>DESCRIPTION</a>.</p>

<pre>   MOUNT /usr/afs/backup/stacker0.1
   UNMOUNT /usr/afs/backup/stacker0.1
   AUTOQUERY NO
   ASK NO
   NAME_CHECK NO</pre>

<p>Finally, the administrator writes the following executable routine in the <em>/usr/afs/backup/stacker0.1</em> file referenced by the <code>MOUNT</code> and <code>UNMOUNT</code> instructions in the <em>CFG_stacker0.1</em> file.</p>

<pre>   #! /bin/csh -f

   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5

   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2

   #--------------------------------------------

   if (${tries} &#62; 1) then
      echo &#34;Too many tries&#34;
      exit ${exit_interactive}
   endif

   if (${operation} == &#34;unmount&#34;) then
      echo &#34;UnMount: Will leave tape in drive&#34;
      exit ${exit_continue}
   endif

   if ((${operation} == &#34;dump&#34;)     |\
       (${operation} == &#34;appenddump&#34;)     |\
       (${operation} == &#34;savedb&#34;))  then

       stackerCmd_NextTape ${devicefile}
       if (${status} != 0)exit${exit_interactive}
       echo &#34;Will continue&#34;
       exit ${exit_continue}
   endif

   if ((${operation} == &#34;labeltape&#34;)    |\
       (${operation} == &#34;readlabel&#34;)) then
      echo &#34;Will continue&#34;
      exit ${exit_continue}
   endif

   echo &#34;Prompt for tape&#34;
   exit ${exit_interactive}</pre>

<p>This routine uses two of the parameters passed to it by the Backup System: <code>tries</code> and <code>operation</code>. It follows the recommended practice of prompting for a tape if the value of the <code>tries</code> parameter exceeds one, because that implies that the stacker is out of tapes.</p>

<p>For a <b>backup dump</b> or backup savedb operation, the routine calls the example <code>stackerCmd_NextTape</code> function provided by the stacker&#39;s manufacturer. Note that the final lines in the file return the exit code that prompts the operator to insert a tape; these lines are invoked when either the stacker cannot load a tape or a the operation being performed is not one of those explicitly mentioned in the file (such as a restore operation).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Example_CFG_device_name_File_for_Dumping_to_a_Data_File"
>Example <em>CFG_<i>device_name</i></em> File for Dumping to a Data File</a></h2>

<p>In this example, the administrator creates the following entry for a backup data file called <em>HSM_device</em> in the <em>/usr/afs/backup/tapeconfig</em> file. It has port offset 20.</p>

<pre>   1G   0K   /dev/HSM_device   20</pre>

<p>The administrator includes the following lines in the <em>/usr/afs/backup/CFG_HSM_device</em> file. To review the meaning of each instruction, see <a href="./DESCRIPTION.html" class="podlinkpod"
>DESCRIPTION</a>.</p>

<pre>   MOUNT /usr/afs/backup/file
   FILE YES
   ASK NO</pre>

<p>Finally, the administrator writes the following executable routine in the <em>/usr/afs/backup/file</em> file referenced by the <code>MOUNT</code> instruction in the <em>CFG_HSM_device</em> file, to control how the Tape Coordinator handles the file.</p>

<pre>   #! /bin/csh -f
   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5

   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2

   #--------------------------------------------

   if (${tries} &#62; 1) then
      echo &#34;Too many tries&#34;
      exit ${exit_interactive}
   endif

   if (${operation} == &#34;labeltape&#34;) then
      echo &#34;Won&#39;t label a tape/file&#34;
      exit ${exit_abort}
   endif

   if ((${operation} == &#34;dump&#34;)   |\
       (${operation} == &#34;appenddump&#34;)   |\
       (${operation} == &#34;restore&#34;)   |\
       (${operation} == &#34;savedb&#34;)    |\
       (${operation} == &#34;restoredb&#34;)) then

      /bin/rm -f ${devicefile}
      /bin/ln -s /hsm/${tapename}_${tapeid} ${devicefile}
      if (${status} != 0) exit ${exit_abort}
   endif

   exit ${exit_continue}</pre>

<p>Like the example routine for a tape stacker, this routine uses the <code>tries</code> and <code>operation</code> parameters passed to it by the Backup System. The <code>tries</code> parameter tracks how many times the Tape Coordinator has attempted to access the file. A value greater than one indicates that the Tape Coordinator cannot access it, and the routine returns exit code 2 (<code>exit_interactive</code>), which results in a prompt for the operator to load a tape. The operator can use this opportunity to change the name of the backup data file specified in the <b>tapeconfig</b> file.</p>

<p>The primary function of this routine is to establish a link between the device file and the file to be dumped or restored. When the Tape Coordinator is executing a <b>backup dump</b>, <b>backup restore</b>, <b>backup savedb</b>, or <b>backup restoredb</b> operation, the routine invokes the UNIX <code>ln -s</code> command to create a symbolic link from the backup data file named in the <em>tapeconfig</em> file to the actual file to use (this is the recommended method). It uses the value of the <code>tapename</code> and <code>tapeid</code> parameters to construct the file name.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/tapeconfig.html" class="podlinkman"
>tapeconfig(5)</a>, <a href="../8/backup_diskrestore.html" class="podlinkpod"
>backup_diskrestore(8)</a>, <a href="../8/backup_dump.html" class="podlinkpod"
>backup_dump(8)</a>, <a href="../8/backup_restoredb.html" class="podlinkpod"
>backup_restoredb(8)</a>, <a href="../8/backup_savedb.html" class="podlinkpod"
>backup_savedb(8)</a>, <a href="../8/backup_volrestore.html" class="podlinkpod"
>backup_volrestore(8)</a>, <a href="../8/backup_volsetrestore.html" class="podlinkpod"
>backup_volsetrestore(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>
<p class="indexlink"><a href="../index.html">Back to Index</a></p>

<!-- end doc -->

</body></html>
