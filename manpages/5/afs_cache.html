<html><head><title>afs_cache</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Mon Jul 14 01:56:35 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>afs_cache - Format of data stored in an AFS client disk cache</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The disk cache on a client machine is composed of multiple <em>V<i>n</i></em> files that contain the data,
a <em>CacheItems</em> file that records index information for all of the <em>V<i>n</i></em> files,
and a <em>VolumeItems</em> file that records the mapping between volume name and mount point for volumes.</p>

<p>When it initializes,
the Cache Manager creates the cache files in the configured cache location.
The standard directory name is <em>/usr/vice/cache</em>,
but it is acceptable to use a directory on a partition with more available space.
To designate a different directory,
change the value in the second field of the <em>/usr/vice/etc/cacheinfo</em> file before issuing the <b>afsd</b> command,
or include the <b>-cachedir</b> argument to the <b>afsd</b> command.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CacheItems"
><em>CacheItems</em></a></h2>

<p>The CacheItems file records information about each file in the disk cache on a client machine (each <em>V<i>n</i></em> file).
The information includes the file ID number and associated volume version number of the AFS file currently stored in the <b>V</b><i>n</i> file,
which enables the Cache Manager to determine which <em>V<i>n</i></em> file contains the AFS data it needs to present to an application.</p>

<p>As it initializes,
the Cache Manager creates the binary-format <em>CacheItems</em> file in the same local disk cache directory as the <em>V<i>n</i></em> files that the <em>CacheItems</em> file describes,
and it must always remain there.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="VolumeItems"
><em>VolumeItems</em></a></h2>

<p>The <em>VolumeItems</em> file records the mapping between volume name and mount point for each volume that the Cache Manager has accessed since it initialized on a client machine using a disk cache.
The Cache Manager uses the mappings to respond correctly to queries about the current working directory,
which can come from the operating system or commands such as the UNIX <b>pwd</b> command.</p>

<p>As it initializes,
the Cache Manager creates the binary-format <em>VolumeItems</em> file in the local disk cache directory,
and it must always remain there.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Vn"
><em>V<i>n</i></em></a></h2>

<p>A <em>V<i>n</i></em> file can store a chunk of cached AFS data on a client machine that is using a disk cache.
As the Cache Manager initializes,
it verifies that the local disk cache directory houses a number of <em>V<i>n</i></em> files equal to the largest of the following:</p>

<ul><li><p>100</p></li><li><p>One and a half times the result of dividing the cache size by the chunk size (cachesize/chunksize * 1.5).</p></li><li><p>The result of dividing the cache size by 10 MB (10,240).</p></li></ul>

<p>The Cache Manager determines the cache size from the <b>-blocks</b> argument to the <b>afsd</b> command,
or if the argument is not included,
from the third field of the <em>/usr/vice/etc/cacheinfo</em> file.
The default chunk size is 64 KB; use the <b>-chunksize</b> argument to the <b>afsd</b> command to override it.
To override the default number of chunks resulting from the calculation,
include the <b>-files</b> argument to the <b>afsd</b> command.
<a href="../8/afsd.html" class="podlinkman"
>afsd(8)</a> describes the restrictions on acceptable values for each of the arguments.</p>

<p>If the disk cache directory houses fewer <em>V<i>n</i></em> files than necessary,
the Cache Manager creates new ones,
assigning each a unique integer <i>n</i> that distinguishes it from the other files; the integers start with 1 and increment by one for each <em>V<i>n</i></em> file created.
The Cache Manager removes files if there are more than necessary.
The Cache Manager also adds and removes <em>V<i>n</i></em> files in response to the <b>fs setcachesize</b> command,
which can be used to alter the cache size between reboots.</p>

<p><em>V<i>n</i></em> files expand and contract to accommodate the size of the AFS directory listing or file they temporarily house.
As mentioned,
by default each <em>V<i>n</i></em> file holds up to 64 KB (65,536 bytes) of a cached AFS element.
AFS elements larger than 64 KB are divided among multiple <b>V</b><i>n</i> files.
If an element is smaller than 64 KB,
the <em>V<i>n</i></em> file expands only to the required size.
A <em>V<i>n</i></em> file accommodates only a single element,
so if there many small cached elements,
it is possible to exhaust the available <em>V<i>n</i></em> files without reaching the maximum cache size.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>Editing or removing the <em>CacheItems</em> or <em>VolumeItems</em> files or a <em>V<i>n</i></em> file can cause a kernel panic.
If the contents of <em>V<i>n</i></em> files seem out of date,
clear the files by using the <b>fs flush</b> or <b>fs flushvolume</b> command.
If any of the cache files are accidentally modified or deleted,
rebooting the machine usually restores normal performance.</p>

<p>To alter cache size (and thus the number of <em>V<i>n</i></em> files) between reboots,
use the <b>fs setcachesize</b> command.
Alternatively,
alter the value of the <b>-blocks</b>,
<b>-files</b> or <b>-chunksize</b> arguments to the <b>afsd</b> command invoked in the machine&#39;s AFS initialization file,
and reboot.
To refresh the contents of one or more <em>V<i>n</i></em> files,
use the <b>fs flush</b> or <b>fs flushvolume</b> command.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../5/cacheinfo.html" class="podlinkman"
>cacheinfo(5)</a>,
<a href="../8/afsd.html" class="podlinkman"
>afsd(8)</a>,
<a href="../1/fs_checkvolumes.html" class="podlinkpod"
>fs_checkvolumes(1)</a>,
<a href="../1/fs_flush.html" class="podlinkpod"
>fs_flush(1)</a>,
<a href="../1/fs_flushvolume.html" class="podlinkpod"
>fs_flushvolume(1)</a>,
<a href="../1/fs_setcachesize.html" class="podlinkpod"
>fs_setcachesize(1)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000.
&#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0.
It was converted from HTML to POD by software written by Chas Williams and Russ Allbery,
based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
