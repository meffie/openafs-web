<html><head><title>vos_release</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Fri Jun 27 16:26:01 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>vos_release - Updates read-only volumes to match the read/write source volume</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>vos release</b> <b>-id</b>&#160;&#60;<i>volume&#160;name&#160;or&#160;ID</i>&#62; [<b>-f</b>] [<b>-cell</b>&#160;&#60;<i>cell&#160;name</i>&#62;] [<b>-noauth</b>] [<b>-localauth</b>] [<b>-verbose</b>] [<b>-help</b>]</p>

<p><b>vos rel</b> <b>-i</b>&#160;&#60;<i>volume&#160;name&#160;or&#160;ID</i>&#62; [<b>-f</b>] [<b>-c</b>&#160;&#60;<i>cell&#160;name</i>&#62;] [<b>-n</b>] [<b>-l</b>] [<b>-v</b>] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>vos release</b> command copies the contents of the indicated read/write source volume to each read-only site defined in the source volume&#39;s Volume Location Database (VLDB) entry.
(Use the <b>vos addsite</b> command to define sites as necessary before issuing this command).
Each read-only copy has the same name as read/write source with the addition of a <code>.readonly</code> extension.</p>

<p>For users to have a consistent view of the file system,
the release of the new volume version must be atomic: either all read-only sites receive the new version,
or all sites keep the version they currently have.
The <b>vos release</b> command is designed to ensure that all copies of the volume&#39;s read-only version match both the read/write source and each other.
In cases where problems such as machine or server process outages prevent successful completion of the release operation,
AFS uses two mechanisms to alert the administrator.</p>

<p>First,
the command interpreter generates an error message on the standard error stream naming each read-only site that did not receive the new volume version.
Second,
during the release operation the Volume Location (VL) Server marks site definitions in the VLDB entry with flags (<code>New release</code> and <code>Old release</code>) that indicate whether or not the site has the new volume version.
If any flags remain after the operation completes,
it was not successful.
The Cache Manager refuses to access a read-only site marked with the <code>Old release</code> flag,
which potentially imposes a greater load on the sites marked with the <code>New release</code> flag.
It is important to investigate and eliminate the cause of the failure and then to issue the <b>vos release</b> command as many times as necessary to complete the release without errors.</p>

<p>The pattern of site flags remaining in the volume&#39;s VLDB entry after a failed release operation can help determine the point at which the operation failed.
Use the <b>vos examine</b> or <b>vos listvldb</b> command to display the VLDB entry.
The VL Server sets the flags in concert with the Volume Server&#39;s operations,
as follows:</p>

<ul><li><p>Before the operation begins,
the VL Server sets the <code>New release</code> flag on the read/write site definition in the VLDB entry and the <code>Old release</code> flag on read-only site definitions (unless the read-only site has been defined since the last release operation and has no actual volume,
in which case its site flag remains <code>Not released</code>).</p></li><li><p>If necessary,
the Volume Server creates a temporary copy (a <i>clone</i>) of the read/write source called the ReleaseClone (see the following discussion of when the Volume Server does or does not create a new ReleaseClone.) It assigns the ReleaseClone its own volume ID number,
which the VL Server records in the <code>RClone</code> field of the source volume&#39;s VLDB entry.</p></li><li><p>The Volume Server distributes a copy of the ReleaseClone to each read-only site defined in the VLDB entry.
As the site successfully receives the new clone,
the VL Server sets the site&#39;s flag in the VLDB entry to <code>New release</code>.</p></li><li><p>When all the read-only copies are successfully released,
the VL Server clears all the <code>New release</code> site flags.
The ReleaseClone is no longer needed,
so the Volume Server deletes it and the VL Server erases its ID from the VLDB entry.</p></li></ul>

<p>By default,
the Volume Server determines automatically whether or not it needs to create a new ReleaseClone:</p>

<ul><li><p>If there are no flags (<code>New release</code>,
<code>Old release</code>,
or <code>Not released</code>) on site definitions in the VLDB entry,
the previous <b>vos release</b> command completed successfully and all read-only sites currently have the same volume.
The Volume Server infers that the current <b>vos release</b> command was issued because the read/write volume has changed.
The Volume Server creates a new ReleaseClone and distributes it to all of the read-only sites.</p></li><li><p>If any site definition in the VLDB entry is marked with a flag,
either the previous release operation did not complete successfully or a new read-only site was defined since the last release.
The Volume Server does not create a new ReleaseClone,
instead distributing the existing ReleaseClone to sites marked with the <code>Old release</code> or <code>Not released</code> flag.
As previously noted,
the VL Server marks each VLDB site definition with the <code>New release</code> flag as the site receives the ReleaseClone,
and clears all flags after all sites successfully receive it.</p></li></ul>

<p>To override the default behavior,
forcing the Volume Server to create and release a new ReleaseClone to the read-only sites,
include the <b>-f</b> flag.
This is appropriate if,
for example,
the data at the read/write site has changed since the existing ReleaseClone was created during the previous release operation.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-id_&#60;volume_name_or_id&#62;"
><b>-id</b> &#60;<i>volume name or id</i>&#62;</a></dt>

<dd>
<p>Specifies either the complete name or volume ID number of a read/write volume.</p>

<dt><a name="-f"
><b>-f</b></a></dt>

<dd>
<p>Creates a new ReleaseClone and distributes it all read-only sites regardless of whether or not any site definitions in the VLDB entry are marked with a flag.</p>

<dt><a name="-cell_&#60;cell_name&#62;"
><b>-cell</b> &#60;<i>cell name</i>&#62;</a></dt>

<dd>
<p>Names the cell in which to run the command.
Do not combine this argument with the <b>-localauth</b> flag.
For more details,
see <a href="../1/vos.html" class="podlinkman"
>vos(1)</a>.</p>

<dt><a name="-noauth"
><b>-noauth</b></a></dt>

<dd>
<p>Assigns the unprivileged identity <code>anonymous</code> to the issuer.
Do not combine this flag with the <b>-localauth</b> flag.
For more details,
see <a href="../1/vos.html" class="podlinkman"
>vos(1)</a>.</p>

<dt><a name="-localauth"
><b>-localauth</b></a></dt>

<dd>
<p>Constructs a server ticket using a key from the local <em>/usr/afs/etc/KeyFile</em> file.
The <b>vos</b> command interpreter presents it to the Volume Server and Volume Location Server during mutual authentication.
Do not combine this flag with the <b>-cell</b> argument or <b>-noauth</b> flag.
For more details,
see <a href="../1/vos.html" class="podlinkman"
>vos(1)</a>.</p>

<dt><a name="-verbose"
><b>-verbose</b></a></dt>

<dd>
<p>Produces on the standard output stream a detailed trace of the command&#39;s execution.
If this argument is omitted,
only warnings and error messages appear.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command.
All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following command clones the read/write volume usr and releases it to the read-only sites defined in its VLDB entry.</p>

<pre>   % vos release usr</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be listed in the <em>/usr/afs/etc/UserList</em> file on the machine specified with the <b>-server</b> argument and on each database server machine. If the <b>-localauth</b> flag is included, the issuer must instead be logged on to a server machine as the local superuser <code>root</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../1/vos.html" class="podlinkman"
>vos(1)</a>, <a href="../1/vos_addsite.html" class="podlinkpod"
>vos_addsite(1)</a>, <a href="../1/vos_examine.html" class="podlinkpod"
>vos_examine(1)</a>, <a href="../1/vos_listvldb.html" class="podlinkpod"
>vos_listvldb(1)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
