<html><head><title>udebug</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Wed Jul 16 06:01:53 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="indexlink"><a href="../index.html">Back to Index</a></p>
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>udebug - Reports Ubik process status for a database server process</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>udebug</b> <b>-servers</b>&#160;&#60;<i>server&#160;machine</i>&#62; [<b>-port</b>&#160;&#60;<i>IP&#160;port</i>&#62;] [<b>-long</b>] [<b>-help</b>]</p>

<p><b>udebug</b> <b>-s</b>&#160;&#60;<i>server&#160;machine</i>&#62; [<b>-p</b>&#160;&#60;<i>IP&#160;port</i>&#62;] [<b>-l</b>] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>udebug</b> command displays the status of the lightweight Ubik process for the database server process identified by the <b>-port</b> argument that is running on the database server machine named by the <b>-servers</b> argument.
The output identifies the machines where peer database server processes are running,
which of them is the synchronization site (Ubik coordinator),
and the status of the connections between them.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-servers_&#60;server_machine&#62;"
><b>-servers</b> &#60;<i>server machine</i>&#62;</a></dt>

<dd>
<p>Names the database server machine that is running the process for which to display status information.
Provide the machine&#39;s IP address in dotted decimal format,
its fully qualified host name (for example,
<b>fs1.abc.com</b>),
or the shortest abbreviated form of its host name that distinguishes it from other machines.
Successful use of an abbreviated form depends on the availability of a name resolution service (such as the Domain Name Service or a local host table) at the time the command is issued.</p>

<dt><a name="-port_&#60;IP_port&#62;"
><b>-port</b> &#60;<i>IP port</i>&#62;</a></dt>

<dd>
<p>Identifies the database server process for which to display status information,
either by its process name or port number.
Provide one of the following values.</p>

<dl>
<dt><a name="buserver_or_7021_for_the_Backup_Server"
><b>buserver</b> or 7021 for the Backup Server
<dt><a name="kaserver_or_7004_for_the_Authentication_Server"
><b>kaserver</b> or 7004 for the Authentication Server
<dt><a name="ptserver_or_7002_for_the_Protection_Server"
><b>ptserver</b> or 7002 for the Protection Server
<dt><a name="vlserver_or_7003_for_the_Volume_Location_Server"
><b>vlserver</b> or 7003 for the Volume Location Server</a></dt>
</dl>

<dt><a name="-long"
><b>-long</b></a></dt>

<dd>
<p>Reports additional information about each peer of the machine named by the <b>-servers</b> argument.
The information appears by default if that machine is the synchronization site.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command.
All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OUTPUT"
>OUTPUT</a></h1>

<p>Several of the messages in the output provide basic status information about the Ubik process on the machine specified by the <b>-servers</b> argument,
and the remaining messages are useful mostly for debugging purposes.</p>

<p>To check basic Ubik status,
issue the command for each database server machine in turn.
In the output for each,
one of the following messages appears in the top third of the output.</p>

<pre>   I am sync site . . . (&#60;#_sites&#62; servers)

   I am not sync site</pre>

<p>For the synchronization site, the following message indicates that all sites have the same version of the database, which implies that Ubik is functioning correctly. See the following for a description of values other than <code>1f</code>.</p>

<pre>   Recovery state 1f</pre>

<p>For correct Ubik operation, the database server machine clocks must agree on the time. The following messages, which are the second and third lines in the output, report the current date and time according to the database server machine&#39;s clock and the clock on the machine where the <b>udebug</b> command is issued.</p>

<pre>   Host&#39;s &#60;IP_addr&#62; time is &#60;dbserver_date/time&#62;
   Local time is &#60;local_date/time&#62; (time differential &#60;skew&#62; secs)</pre>

<p>The &#60;skew&#62; is the difference between the database server machine clock and the local clock. Its absolute value is not vital for Ubik functioning, but a difference of more than a few seconds between the <i>skew</i> values for the database server machines indicates that their clocks are not synchronized and Ubik performance is possibly hampered.</p>

<p>Following is a description of all messages in the output. As noted, it is useful mostly for debugging and most meaningful to someone who understands Ubik&#39;s implementation.</p>

<p>The output begins with the following messages. The first message reports the IP addresses that are configured with the operating system on the machine specified by the <b>-servers</b> argument. As previously noted, the second and third messages report the current date and time according to the clocks on the database server machine and the machine where the <b>udebug</b> command is issued, respectively. All subsequent timestamps in the output are expressed in terms of the local clock rather than the database server machine clock.</p>

<pre>   Host&#39;s addresses are: &#60;list_of_IP_addrs&#62;
   Host&#39;s &#60;IP_addr&#62; time is &#60;dbserver_date/time&#62;
   Local time is &#60;local_date/time&#62; (time differential &#60;skew&#62; secs)</pre>

<p>If the &#60;skew&#62; is more than about 10 seconds, the following message appears. As noted, it does not necessarily indicate Ubik malfunction: it denotes clock skew between the database server machine and the local machine, rather than among the database server machines.</p>

<pre>   ****clock may be bad</pre>

<p>If the udebug command is issued during the coordinator election process and voting has not yet begun, the following message appears next.</p>

<pre>   Last yes vote not cast yet</pre>

<p>Otherwise, the output continues with the following messages.</p>

<pre>   Last yes vote for &#60;sync_IP_addr&#62; was &#60;last_vote&#62; secs ago (sync site);
   Last vote started &#60;vote_start&#62; secs ago (at &#60;date/time&#62;)
   Local db version is &#60;db_version&#62;</pre>

<p>The first indicates which peer this Ubik process last voted for as coordinator (it can vote for itself) and how long ago it sent the vote. The second message indicates how long ago the Ubik coordinator requested confirming votes from the secondary sites. Usually, the &#60;last_vote&#62; and &#60;vote_start&#62; values are the same; a difference between them can indicate clock skew or a slow network connection between the two database server machines. A small difference is not harmful. The third message reports the current version number &#60;db_version&#62; of the database maintained by this Ubik process. It has two fields separated by a period. The field before the period is based on a timestamp that reflects when the database first changed after the most recent coordinator election, and the field after the period indicates the number of changes since the election.</p>

<p>The output continues with messages that differ depending on whether the Ubik process is the coordinator or not.</p>

<ul><li><p>If there is only one database server machine, it is always the coordinator (synchronization site), as indicated by the following message.
<pre>   I am sync site forever (1 server)</pre>
</p></li><li><p>If there are multiple database sites, and the <b>-servers</b> argument names the coordinator (synchronization site), the output continues with the following two messages.
<pre>   I am sync site until &#60;expiration&#62; secs from now (at &#60;date/time&#62;)
       (&#60;#_sites&#62; servers)
   Recovery state &#60;flags&#62;</pre>

<p>The first message (which is reported on one line) reports how much longer the site remains coordinator even if the next attempt to maintain quorum fails, and how many sites are participating in the quorum. The <i>flags</i> field in the second message is a hexadecimal number that indicates the current state of the quorum. A value of <code>1f</code> indicates complete database synchronization, whereas a value of <code>f</code> means that the coordinator has the correct database but cannot contact all secondary sites to determine if they also have it. Lesser values are acceptable if the <b>udebug</b> command is issued during coordinator election, but they denote a problem if they persist. The individual flags have the following meanings:</p>

<dl>
<dt><a name="0x1"
>0x1</a></dt>

<dd>
<p>This machine is the coordinator.</p>

<dt><a name="0x2"
>0x2</a></dt>

<dd>
<p>The coordinator has determined which site has the database with the highest version number.</p>

<dt><a name="0x4"
>0x4</a></dt>

<dd>
<p>The coordinator has a copy of the database with the highest version number.</p>

<dt><a name="0x8"
>0x8</a></dt>

<dd>
<p>The database&#39;s version number has been updated correctly.</p>

<dt><a name="0x10"
>0x10</a></dt>

<dd>
<p>All sites have the database with the highest version number.</p>
</dd>
</dl>

<p>If the udebug command is issued while the coordinator is writing a change into the database, the following additional message appears.</p>

<pre>   I am currently managing write transaction I&#60;identifier&#62;</pre>
</p></li><li><p>If the <b>-servers</b> argument names a secondary site, the output continues with the following messages.
<pre>   I am not sync site
   Lowest host &#60;lowest_IP_addr&#62; was set &#60;low_time&#62; secs ago
   Sync host &#60;sync_IP_addr&#62; was set &#60;sync_time&#62; secs ago</pre>

<p>The &#60;lowest_IP_addr&#62; is the lowest IP address of any peer from which the Ubik process has received a message recently, whereas the &#60;sync_IP_addr&#62; is the IP address of the current coordinator. If they differ, the machine with the lowest IP address is not currently the coordinator. The Ubik process continues voting for the current coordinator as long as they remain in contact, which provides for maximum stability. However, in the event of another coordinator election, this Ubik process votes for the &#60;lowest_IP_addr&#62; site instead (assuming they are in contact), because it has a bias to vote in elections for the site with the lowest IP address.</p>
</p></li></ul>

<p>For both the synchronization and secondary sites, the output continues with the following messages. The first message reports the version number of the database at the synchronization site, which needs to match the &#60;db_version&#62; reported by the preceding <code>Local db version</code> message. The second message indicates how many VLDB records are currently locked for any operation or for writing in particular. The values are nonzero if the <b>udebug</b> command is issued while an operation is in progress.</p>

<pre>   Sync site&#39;s db version is &#60;db_version&#62;
   &#60;locked&#62; locked pages, &#60;writes&#62; of them for write</pre>

<p>The following messages appear next only if there are any read or write locks on database records:</p>

<pre>   There are read locks held
   There are write locks held</pre>

<p>Similarly, one or more of the following messages appear next only if there are any read or write transactions in progress when the <b>udebug</b> command is issued:</p>

<pre>   There is an active write transaction
   There is at least one active read transaction
   Transaction tid is &#60;tid&#62;</pre>

<p>If the machine named by the <b>-servers</b> argument is the coordinator, the next message reports when the current coordinator last updated the database.</p>

<pre>    Last time a new db version was labelled was:
            &#60;last_restart&#62; secs ago (at &#60;date/time&#62;)</pre>

<p>If the machine named by the <b>-servers</b> argument is the coordinator, the output concludes with an entry for each secondary site that is participating in the quorum, in the following format.</p>

<pre>   Server (&#60;IP_address&#62;): (db &#60;db_version&#62;)
   last vote rcvd &#60;last_vote&#62; secs ago (at &#60;date/time&#62;),
   last beacon sent &#60;last_beacon&#62; secs ago (at &#60;date/time&#62;),
       last vote was { yes | no }
   dbcurrent={ 0 | 1 }, up={ 0 | 1 } beaconSince={ 0 | 1 }</pre>

<p>The first line reports the site&#39;s IP address and the version number of the database it is maintaining. The &#60;last_vote&#62; field reports how long ago the coordinator received a vote message from the Ubik process at the site, and the &#60;last_beacon&#62; field how long ago the coordinator last requested a vote message. If the <b>udebug</b> command is issued during the coordinator election process and voting has not yet begun, the following messages appear instead.</p>

<pre>   Last vote never rcvd
   Last beacon never sent</pre>

<p>On the final line of each entry, the fields have the following meaning:</p>

<ul><li><p><code>dbcurrent</code> is <code>1</code> if the site has the database with the highest version number, <code>0</code> if it does not.</p></li><li><p><code>up</code> is <code>1</code> if the Ubik process at the site is functioning correctly, <code>0</code> if it is not.</p></li><li><p><code>beaconSince</code> is <code>1</code> if the site has responded to the coordinator&#39;s last request for votes, <code>0</code> if it has not.</p></li></ul>

<p>Including the <b>-long</b> flag produces peer entries even when the <b>-servers</b> argument names a secondary site, but in that case only the <i>IP_address</i> field is guaranteed to be accurate. For example, the value in the &#60;db_version&#62; field is usually <code>0.0</code>, because secondary sites do not poll their peers for this information. The values in the <i>last_vote</i> and <i>last_beacon</i> fields indicate when this site last received or requested a vote as coordinator; they generally indicate the time of the last coordinator election.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>This example checks the status of the Ubik process for the Volume Location Server on the machine <code>afs1</code>, which is the synchronization site.</p>

<pre>   % udebug afs1 vlserver
   Host&#39;s addresses are: 192.12.107.33
   Host&#39;s 192.12.107.33 time is Wed Oct 27 09:49:50 1999
   Local time is Wed Oct 27 09:49:52 1999 (time differential 2 secs)
   Last yes vote for 192.12.107.33 was 1 secs ago (sync site);
   Last vote started 1 secs ago (at Wed Oct 27 09:49:51 1999)
   Local db version is 940902602.674
   I am sync site until 58 secs from now (at Wed Oct 27 09:50:50 1999) (3 servers)
   Recovery state 1f
   Sync site&#39;s db version is 940902602.674
   0 locked pages, 0 of them for write
   Last time a new db version was labelled was:
            129588 secs ago (at Mon Oct 25 21:50:04 1999)

   Server( 192.12.107.35 ): (db 940902602.674)
       last vote rcvd 2 secs ago (at Wed Oct 27 09:49:50 1999),
       last beacon sent 1 secs ago (at Wed Oct 27 09:49:51 1999), last vote was yes
       dbcurrent=1, up=1 beaconSince=1

   Server( 192.12.107.34 ): (db 940902602.674)
       last vote rcvd 2 secs ago (at Wed Oct 27 09:49:50 1999),
       last beacon sent 1 secs ago (at Wed Oct 27 09:49:51 1999), last vote was yes
       dbcurrent=1, up=1 beaconSince=1</pre>

<p>This example checks the status of the Authentication Server on the machine with IP address 192.12.107.34, which is a secondary site. The local clock is about 4 minutes behind the database server machine&#39;s clock.</p>

<pre>   % udebug 192.12.107.34 7004
   Host&#39;s addresses are: 192.12.107.34
   Host&#39;s 192.12.107.34 time is Wed Oct 27 09:54:15 1999
   Local time is Wed Oct 27 09:50:08 1999 (time differential -247 secs)
   ****clock may be bad
   Last yes vote for 192.12.107.33 was 6 secs ago (sync site);
   Last vote started 6 secs ago (at Wed Oct 27 09:50:02 1999)
   Local db version is 940906574.25
   I am not sync site
   Lowest host 192.12.107.33 was set 6 secs ago
   Sync host 192.12.107.33 was set 6 secs ago
   Sync site&#39;s db version is 940906574.25
   0 locked pages, 0 of them for write</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>None</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../8/buserver.html" class="podlinkman"
>buserver(8)</a>, <a href="../8/kaserver.html" class="podlinkman"
>kaserver(8)</a>, <a href="../8/ptserver.html" class="podlinkman"
>ptserver(8)</a>, <a href="../8/vlserver.html" class="podlinkman"
>vlserver(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>
<p class="indexlink"><a href="../index.html">Back to Index</a></p>

<!-- end doc -->

</body></html>
