<html><head><title>fs_setserverprefs</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by OpenAFS::HTML v1.1,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Sat Jul 12 06:02:24 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to OpenAFS::HTML, and/or subclassing OpenAFS::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of OpenAFS::HTML for advice.
   See 'perldoc OpenAFS::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>fs_setserverprefs - Sets the preference ranks for file servers or VL servers</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>fs setserverprefs</b> [<b>-servers</b>&#160;&#60;<i>fileserver&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-vlservers</b>&#160;&#60;<i>VL&#160;server&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-file</b>&#160;&#60;<i>input&#160;from&#160;named&#160;file</i>&#62;] [<b>-stdin</b>] [<b>-help</b>]</p>

<p><b>fs sets</b> [<b>-se</b>&#160;&#60;<i>fileserver&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-vl</b>&#160;&#60;<i>VL&#160;server&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-f</b>&#160;&#60;<i>input&#160;from&#160;named&#160;file</i>&#62;] [<b>-st</b>] [<b>-h</b>]</p>

<p><b>fs sp</b> [<b>-se</b>&#160;&#60;<i>fileserver&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-vl</b>&#160;&#60;<i>VL&#160;server&#160;names&#160;and&#160;ranks</i>&#62;+] [<b>-f</b>&#160;&#60;<i>input&#160;from&#160;named&#160;file</i>&#62;] [<b>-st</b>] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>fs setserverprefs</b> command sets the local Cache Manager&#39;s preference ranks for one or more file server machine interfaces or,
if the <b>-vlserver</b> argument is provided,
for Volume Location (VL) Server machines.
For file server machines,
the numerical ranks determine the order in which the Cache Manager attempts to contact the interfaces of machines that are housing a volume.
For VL Server machines,
the ranks determine the order in which the Cache Manager attempts to contact a cell&#39;s VL Servers when requesting VLDB information.</p>

<p>The <b>fs getserverprefs</b> reference page explains how the Cache Manager uses preference ranks when contacting file server machines or VL Server machines.
The following paragraphs explain how the Cache Manager calculates default ranks,
and how to use this command to change the defaults.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Calculation_of_Default_Preference_Ranks"
>Calculation of Default Preference Ranks</a></h2>

<p>The Cache Manager stores a preference rank in kernel memory as a paired IP address and numerical rank.
If a file server machine is multihomed,
the Cache Manager assigns a distinct rank to each of the machine&#39;s addresses (up to the number of addresses that the VLDB can store per machine,
which is specified in the <i>IBM AFS Release Notes</i>).
Once calculated,
a rank persists until the machine reboots,
or until this command is used to change it.</p>

<p>The Cache Manager sets default VL Server preference ranks as it initializes,
randomly assigning a rank from the range 10,000 to 10,126 to each of the machines listed in the local <em>/usr/vice/etc/CellServDB</em> file.
Machines from different cells can have the same rank,
but this does not present a problem because the Cache Manager consults only one cell&#39;s ranks at a time.</p>

<p>The Cache Manager sets default preference ranks for file server machine as it fetches volume location information from the VLDB.
Each time it learns about file server machine interfaces for which it has not already set ranks,
it assigns a rank to each interface.
If the local client machine has only one IP address,
the Cache Manager compares it to the server interface&#39;s IP address and sets a rank according to the following algorithm.
If the client machine is multihomed,
the Cache Manager applies the algorithm to each of the client machine&#39;s addresses and assigns to the file server machine interface the lowest rank that results.</p>

<ul><li><p>If the local machine is a file server machine,
the base rank for each of its interfaces is 5,000.</p></li><li><p>If the file server machine interface is on the same subnetwork as the client interface,
its base rank is 20,000.</p></li><li><p>If the file server machine interface is on the same network as the client interface,
or is at the distant end of a point-to-point link with the client interface,
its base rank is 30,000.</p></li><li><p>If the file server machine interface is on a different network than the client interface,
or the Cache Manager cannot obtain network information about it,
its base rank is 40,000.</p></li></ul>

<p>After assigning a base rank to a file server machine interface,
the Cache Manager adds to it a number randomly chosen from the range 0 (zero) to 14.
As an example,
a file server machine interface in the same subnetwork as the local machine receives a base rank of 20,000,
but the Cache Manager records the actual rank as an integer between 20,000 and 20,014.
This process reduces the number of interfaces that have exactly the same rank.
As with VL Server machine ranks,
it is possible for file server machine interfaces from foreign cells to have the same rank as interfaces in the local cell,
but this does not present a problem.
Only the relative ranks of the interfaces that house a given volume are relevant,
and AFS only supports storage of a volume in one cell at a time.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Setting_Non-default_Preference_Ranks"
>Setting Non-default Preference Ranks</a></h2>

<p>Use the <b>fs setserverprefs</b> command to reset an existing preference rank,
or to set the initial rank of a file server machine interface or VL Server machine for which the Cache Manager has no rank.
To make a rank persist across a reboot of the local machine,
place the appropriate <b>fs setserverprefs</b> command in the machine&#39;s AFS initialization file.</p>

<p>Specify each preference rank as a pair of values separated by one or more spaces:</p>

<ul><li><p>The first member of the pair is the fully-qualified hostname (for example,
<code>fs1.abc.com</code>),
or the IP address in dotted decimal format,
of a file server machine interface or VL Server machine</p></li><li><p>The second member of the pair is an integer.
The possible ranks range from <code>1</code> through <code>65535</code>.</p></li></ul>

<p>As with default ranks,
the Cache Manager adds a randomly chosen integer to a rank specified by this command.
For file server machine interfaces,
the integer is from the range 0 (zero) to 14; for VL Server machines,
it is from the range 0 (zero) to 126.
For example,
if the administrator assigns a rank of 15,000 to a file server machine interface,
the Cache Manager stores an integer between 15,000 to 15,014.</p>

<p>There are several ways to provide ranks for file server machine interfaces (but not for VL Server machines):</p>

<ul><li><p>On the command line,
following the <b>-servers</b> argument.</p></li><li><p>In a file named by the <b>-file</b> argument.
Place each pair on its own line in the file.
Directing the output from the <b>fs getserverprefs</b> command to a file automatically generates a file with the proper format.</p></li><li><p>Via the standard input stream,
by providing the <b>-stdin</b> flag.
This method enables the issuer to feed in values directly from a program or script that generates preference ranks by using an algorithm appropriate to the local cell.
The AFS distribution does not include such programs or scripts.</p></li></ul>

<p>When setting file server machine preference ranks,
it is legal to combine the <b>-servers</b>,
<b>-file</b>,
and <b>-stdin</b> options on a single command line.
If different options specify a different rank for the same interface,
the Cache Manager stores and uses the rank assigned with the <b>-servers</b> argument.</p>

<p>The <b>-vlservers</b> argument is the only way to assign VL Server machine ranks.
It can be combined with one or more of the <b>-servers</b>,
<b>-file</b>,
and <b>-stdin</b> options,
but the Cache Manager applies the values provided for those options to file server machine ranks only.</p>

<p>The fs command interpreter does not verify hostnames or IP addresses,
and so assigns preference ranks to invalid machine names or addresses.
The Cache Manager never uses such ranks unless the same incorrect information is in the VLDB.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-servers_&#60;file_server_names_and_ranks&#62;+"
><b>-servers</b> &#60;<i>file server names and ranks</i>&#62;+</a></dt>

<dd>
<p>Specifies one or more file server machine preference ranks.
Each rank pairs the fully-qualified hostname or IP address (in dotted decimal format) of a file server machine&#39;s interface with an integer rank,
separated by one or more spaces; also separate each pair with one or more spaces.
Acceptable values for the rank range from <code>1</code> through <code>65521</code>; a lower value indicates a greater preference.
Providing ranks outside this range can have unpredictable results.
Providing a value no larger than <code>65521</code> guarantees that the rank does not exceed the maximum possible value of 65,535 even if the largest random factor (14) is added.</p>

<p>This argument can be combined with the <b>-file</b> argument,
<b>-stdin</b> flag,
or both.
If more than one of the arguments sets a rank for the same interface,
the rank set by this argument takes precedence.
It can also be combined with the <b>-vlservers</b> argument,
but does not interact with it.</p>

<dt><a name="-vlservers_&#60;VL_server_names_and_ranks&#62;+"
><b>-vlservers</b> &#60;<i>VL server names and ranks</i>&#62;+</a></dt>

<dd>
<p>Specifies one or more VL Server preference ranks.
Each rank pairs the fully-qualified hostname or IP address (in dotted decimal format) of a VL Server machine with an integer rank,
separated by one or more spaces; also separate each pair with one or more spaces.
Acceptable values for the rank range from <code>1</code> through <code>65521</code>; a lower value indicates a greater preference.
Providing ranks outside this range can have unpredictable results.
Providing a value no larger than <code>65521</code> guarantees that the rank does not exceed the maximum possible value of 65,535 even if the largest random factor (14) is added.</p>

<p>This argument can be combined with the <b>-servers</b> argument,
<b>-file</b> argument,
<b>-stdin</b> flag,
or any combination of the three,
but does not interact with any of them.
They apply only to file server machine ranks.</p>

<dt><a name="-file_&#60;input_file&#62;"
><b>-file</b> &#60;<i>input file</i>&#62;</a></dt>

<dd>
<p>Specifies the full pathname of a file from which to read pairs of file server machine interfaces and their ranks,
using the same notation and range of values as for the <b>-servers</b> argument.
In the file,
place each pair on its own line and separate the two parts of each pair with one or more spaces.</p>

<p>This argument can be combined with the <b>-servers</b> argument,
<b>-stdin</b> flag,
or both.
If more than one of the arguments sets a rank for the same interface,
the rank set by the <b>-server</b> argument takes precedence.
It can also be combined with the <b>-vlservers</b> argument,
but does not interact with it.</p>

<dt><a name="-stdin"
><b>-stdin</b></a></dt>

<dd>
<p>Reads pairs of file server machine interface and integer rank from the standard input stream.
The intended use is to accept input piped in from a user-defined program or script that generates ranks in the appropriate format,
but it also accepts input typed to the shell.
Format the interface and rank pairs as for the <b>-file</b> argument.
If typing at the shell,
type Ctrl-D after the final newline to complete the input.</p>

<p>This argument can be combined with the <b>-servers</b> argument,
the <b>-file</b> argument,
or both.
If more than one of the arguments sets a rank for the same interface,
the rank set by the <b>-server</b> argument takes precedence.
It can also be combined with the <b>-vlservers</b> argument,
but does not interact with it.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command.
All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following command sets the Cache Manager&#39;s preference ranks for the file server machines named <code>fs3.abc.com</code> and <code>fs4.abc.com</code>,
the latter of which is specified by its IP address,
192.12.105.100.
The machines reside in another subnetwork of the local machine&#39;s network,
so their default base rank is 30,000.
To increase the Cache Manager&#39;s preference for these machines,
the issuer assigns a rank of <code>25000</code>,
to which the Cache Manager adds an integer in the range from 0 to 15.</p>

<pre>   # fs setserverprefs -servers fs3.abc.com 25000 192.12.105.100 25000</pre>

<p>The following command uses the <b>-servers</b> argument to set the Cache Manager&#39;s preference ranks for the same two file server machines, but it also uses the <b>-file</b> argument to read a collection of preference ranks from a file that resides in the local file <em>/etc/fs.prefs</em>:</p>

<pre>   # fs setserverprefs -servers fs3.abc.com 25000 192.12.105.100 25000 \
       -file /etc/fs.prefs</pre>

<p>The /etc/fs.prefs file has the following contents and format:</p>

<pre>   192.12.108.214        7500
   192.12.108.212        7500
   138.255.33.41         39000
   138.255.33.34         39000
   128.0.45.36           41000
   128.0.45.37           41000</pre>

<p>The following command uses the <b>-stdin</b> flag to read preference ranks from the standard input stream. The ranks are piped to the command from a program, <b>calc_prefs</b>, which was written by the issuer to calculate preferences based on values significant to the local cell.</p>

<pre>   # calc_prefs | fs setserverprefs -stdin</pre>

<p>The following command uses the <b>-vlservers</b> argument to set the Cache Manager&#39;s preferences for the VL server machines named <code>fs1.abc.com</code>, <code>fs3.abc.com</code>, and <code>fs4.abc.com</code> to base ranks of 1, 11000, and 65521, respectively:</p>

<pre>   # fs setserverprefs -vlservers fs1.abc.com 1 fs3.abc.com 11000 \
       fs4.abc.com 65521</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>The issuer must be logged in as the local superuser root.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../1/fs_getserverprefs.html" class="podlinkpod"
>fs_getserverprefs(1)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>

<!-- end doc -->

</body></html>
