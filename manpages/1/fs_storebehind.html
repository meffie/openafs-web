<html><head><title>fs_storebehind</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="style" type="text/css" href="../style.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Tue Nov 11 07:45:44 2008 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="indexlink"><a href="../index.html">Back to Index</a></p>
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>fs_storebehind - Enables asynchronous writes to the file server</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>


<div class="synopsis">


<p><b>fs storebehind</b> [<b>-kbytes</b>&#160;&#60;<i>asynchrony&#160;for&#160;specified&#160;names</i>&#62;] [<b>-files</b>&#160;&#60;<i>specific&#160;pathnames</i>&#62;+] [<b>-allfiles</b>&#160;&#60;<i>new&#160;default&#160;(KB)</i>&#62;] [<b>-verbose</b>] [<b>-help</b>]</p>

<p><b>fs st</b> [<b>-k</b>&#160;&#60;<i>asynchrony&#160;for&#160;specified&#160;names</i>&#62;] [<b>-f</b>&#160;&#60;<i>specific&#160;pathnames</i>&#62;+] [<b>-a</b>&#160;&#60;<i>new&#160;default&#160;(KB)</i>&#62;] [<b>-v</b>] [<b>-h</b>]</p>


</div>


<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <b>fs storebehind</b> command enables the Cache Manager to perform a delayed asynchronous write to the File Server when an application closes a file.
By default,
the Cache Manager writes all data to the File Server immediately and synchronously when an application program closes a file -- that is,
the close() system call does not return until the Cache Manager has actually transferred the final chunk of the file to the File Server.
This command specifies the number of kilobytes of a file that can still remain to be written to the File Server when the Cache Manager returns control to the application.
It is useful if users working on the machine commonly work with very large files,
but also introduces the complications discussed in the <a href="./CAUTIONS.html" class="podlinkpod"
>CAUTIONS</a>.</p>

<p>Set either or both of the following in a single command:</p>

<ul><li><p>To set a value that applies to all AFS files manipulated by applications running on the machine,
use the <b>-allfiles</b> argument.
This value is termed the <i>default store asynchrony</i> for the machine,
and persists until the machine reboots.
If it is not set,
the default value is zero,
indicating that the Cache Manager performs synchronous writes.
<p>As an example,
the following setting means that when an application closes a file,
the Cache Manager can return control to the application as soon as no more than 10 kilobytes of the file remain to be written to the File Server.</p>

<pre>   -allfiles 10</pre>
</p></li><li><p>To set a value that applies to one or more individual files, and overrides the value of the <b>-allfiles</b> argument for them, combine the <b>-kbytes</b> and <b>-files</b> arguments. The setting persists as long as there is an entry for the file in the kernel table that the Cache Manager uses to track certain information about files. In general, such an entry persists at least until an application closes the file or exits, but the Cache Manager is free to recycle the entry if the file is inactive and it needs to free up slots in the table. To increase the certainty that there is an entry for the file in the table, issue the <b>fs storebehind</b> command shortly before closing the file.
<p>As an example, the following setting means that when an application closes either of the files <b>bigfile</b> and <b>biggerfile</b>, the Cache Manager can return control to the application as soon as no more than a megabyte of the file remains to be written to the File Server.</p>

<pre>   -kbytes 1024 -files bigfile biggerfile</pre>

<p>Note that once an explicit value has been set for a file, the only way to make it subject to the default store asynchrony once again is to set <b>-kbytes</b> to that value. In other words, there is no combination of arguments that automatically makes a file subject to the default store asynchrony once another value has been set for the file.</p>
</p></li></ul>

<p>To display the settings that currently apply to individual files or to all files, provide the command&#39;s arguments in certain combinations as specified in <a href="./OUTPUT.html" class="podlinkpod"
>OUTPUT</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAUTIONS"
>CAUTIONS</a></h1>

<p>For the following reasons, use of this command is not recommended in most cases.</p>

<p>In normal circumstances, an asynchronous setting results in the Cache Manager returning control to applications earlier than it otherwise does, but this is not guaranteed.</p>

<p>If a delayed write fails, there is no way to notify the application, since the close() system call has already returned with a code indicating success.</p>

<p>Writing asynchronously increases the possibility that the user will not notice if a write operation makes the volume that houses the file exceed its quota. As always, the portion of the file that exceeds the volume&#39;s quota is lost, which prompts a message such as the following:</p>

<pre>   No space left on device</pre>

<p>To avoid losing data, it is advisable to verify that the volume housing the file has space available for the amount of data anticipated to be written.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<dl>
<dt><a name="-kbytes_&#60;asynchrony_for_specified_names&#62;"
><b>-kbytes</b> &#60;<i>asynchrony for specified names</i>&#62;</a></dt>

<dd>
<p>Specifies the number of kilobytes of data from each file named by the <b>-files</b> argument that can remain to be written to the file server when the Cache Manager returns control to an application program that closed the file. The <b>-files</b> argument is required along with this argument. Provide an integer from the range <code>0</code> (which reinstates the Cache Manager&#39;s default behavior or writing synchronously) to the maximum AFS file size.</p>

<dt><a name="-files_&#60;specific_pathnames&#62;+"
><b>-files</b> &#60;<i>specific pathnames</i>&#62;+</a></dt>

<dd>
<p>Names each file to which the value set with the <b>-kbytes</b> argument applies. The setting persists as long as there is an entry for the file in the kernel table that the Cache Manager uses to track certain information about files. Because closing a file generally erases the entry, when reopening a file the only way to guarantee that the setting still applies is to reissue the command. If this argument is provided without the <b>-kbytes</b> argument, the command reports the current setting for the specified files, and the default store asynchrony.</p>

<dt><a name="-allfiles_&#60;new_default_(KB)&#62;"
><b>-allfiles</b> &#60;<i>new default (KB)</i>&#62;</a></dt>

<dd>
<p>Sets the default store asynchrony for the local machine, which is the number of kilobytes of data that can remain to be written to the file server when the Cache Manager returns control to the application program that closed a file. The value applies to all AFS files manipulated by applications running on the machine, except those for which settings have been made with the <b>-kbytes</b> and <b>-files</b> arguments. Provide an integer from the range <code>0</code> (which indicates the default of synchronous writes) to the maximum AFS file size.</p>

<dt><a name="-verbose"
><b>-verbose</b></a></dt>

<dd>
<p>Produces output confirming the settings made with the accompanying <b>-kbytes</b> and <b>-files</b> arguments, the <b>-allfiles</b> argument, or all three. If provided by itself, reports the current default store asynchrony.</p>

<dt><a name="-help"
><b>-help</b></a></dt>

<dd>
<p>Prints the online help for this command. All other valid options are ignored.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OUTPUT"
>OUTPUT</a></h1>

<p>If none of the command&#39;s options are included, or if only the <b>-verbose</b> flag is included, the following message reports the default store asynchrony (the setting that applies to all files manipulated by applications running on the local machine and for which not more specific asynchrony is set).</p>

<pre>   Default store asynchrony is &#60;x&#62; kbytes.</pre>

<p>A value of <code>0</code> (zero) indicates synchronous writes and is the default if no one has included the <b>-allfiles</b> argument on this command since the machine last rebooted.</p>

<p>If the <b>-files</b> argument is provided without the <b>-kbytes</b> argument, the output reports the value that applies to each specified file along with the default store asynchrony. If a particular value has previously been set for a file, the following message reports it:</p>

<pre>   Will store up to &#60;y&#62; kbytes of &#60;file&#62; asynchronously.
   Default store asynchrony is &#60;x&#62; kbytes.</pre>

<p>If the default store asynchrony applies to a file because no explicit <b>-kbytes</b> value has been set for it, the message is instead as follows:</p>

<pre>   Will store &#60;file&#62; according to default.
   Default store asynchrony is &#60;x&#62; kbytes.</pre>

<p>If the <b>-verbose</b> flag is combined with arguments that set values (<b>-files</b> and <b>-kbytes</b>, or <b>-allfiles</b>, or all three), there is a message that confirms immediately that the setting has taken effect. When included without other arguments or flags, the <b>-verbose</b> flag reports the default store asynchrony only.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<p>The following command enables the Cache Manager to return control to the application program that closed the file <em>test.data</em> when 100 kilobytes still remain to be written to the File Server. The <b>-verbose</b> flag produces output that confirms the new setting, and that the default store asynchrony is zero.</p>

<pre>   % fs storebehind -kbytes 100 -files test.data -verbose
   Will store up to 100 kbytes of test.data asynchronously.
   Default store asynchrony is 0 kbytes.</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVILEGE_REQUIRED"
>PRIVILEGE REQUIRED</a></h1>

<p>To include the <b>-allfiles</b> argument, the issuer must be logged in as the local superuser <code>root</code>.</p>

<p>To include the <b>-kbytes</b> and <b>-files</b> arguments, the issuer must either be logged in as the local superuser <code>root</code> or have the <code>w</code> (write) permission on the ACL of each file&#39;s directory.</p>

<p>To view the current settings (by including no arguments, the <b>-file</b> argument alone, or the <b>-verbose</b> argument alone), no privilege is required.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../8/afsd.html" class="podlinkman"
>afsd(8)</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>IBM Corporation 2000. &#60;http://www.ibm.com/&#62; All Rights Reserved.</p>

<p>This documentation is covered by the IBM Public License Version 1.0. It was converted from HTML to POD by software written by Chas Williams and Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.</p>
<p class="indexlink"><a href="../index.html">Back to Index</a></p>

<!-- end doc -->

</body></html>
